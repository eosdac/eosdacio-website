<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>
    
      eosDAC | 
    
  </title>
  <meta property="og:title" content="eosDAC">
  <meta property="og:site_name" content="eosDAC">
  <meta name="description" content="The Community-Owned EOS Block Producer and DAC Enabler">
  <meta property="og:description" content="The Community-Owned EOS Block Producer and DAC Enabler">
  <link rel="shortcut icon" type="image/png" href="/assets/favicon.png?1586616978">
  <link href="/assets/styles.css?1586616978s" rel="stylesheet">
  <link href="https://vjs.zencdn.net/7.4.1/video-js.css" rel="stylesheet">
  <link rel="stylesheet" href="/assets/videojs-resolution-switcher.css">
  <link rel="stylesheet"
    href="https://unpkg.com/bootstrap-material-design@4.1.1/dist/css/bootstrap-material-design.min.css"
    integrity="sha384-wXznGJNEXNG1NFsbm0ugrLFMQPWswR3lds2VeinahP8N0zJw9VWSopbjv2x7WCvX"
    crossorigin="anonymous">
  <link rel="stylesheet" href="/assets/bootstrap-material-design-overwrite.css?1586616978">
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css?family=Roboto:100,200,300,400,500,600">
  <link rel="stylesheet" href="/assets/main.css?1586616978">
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="crossorigin="anonymous"></script><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="site.title" /><link rel="alternate" hreflang="en" href="https://eosdac.io">
  <link rel="alternate" hreflang="ko" href="https://eosdac.io/ko/">
  <link rel="alternate" hreflang="zh-hans" href="https://eosdac.io/zh-hans/">
  <link rel="alternate" hreflang="vi" href="https://eosdac.io/vi/">
  <link rel="alternate" hreflang="ja" href="https://eosdac.io/ja/">
  <link rel="alternate" hreflang="es" href="https://eosdac.io/es/">
  <link rel="alternate" hreflang="ru" href="https://eosdac.io/ru/">
  <link rel="canonical" href="https://eosdac.io/">
  <script src="/assets/vconsole.min.js"></script>
  <script>
    // Init vConsole, if the ?debug=true parameter exists
    if(window.location.search.substr(1).indexOf('debug=true') >= 0) {
      var vConsole = new VConsole()
    }
  </script>
</head>
<body><header class="site-header" role="banner" style="border:0">
  <nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark nav-tabs"
    style="background-image:linear-gradient(to right, #4A1289, #7C41BA)">
    <a class="navbar-brand" href="/">
      <img src="/assets/signet-white.svg" height="42" alt="eosDAC">
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse"
      data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false"
      aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav mr-auto">
        
        
        
        
        
        
        <li class="nav-item"><a class="nav-link" href="/why-vote/">
            Why Vote for eosDAC?</a></li>
        
        
        
        
        
        <li class="nav-item"><a class="nav-link" href="/why-join/">
            Why Join eosDAC?</a></li>
        
        
        
        
        
        <li class="nav-item"><a class="nav-link" href="/why-launch/">
            Why Launch a DAC?</a></li>
        
        
        
        <li class="nav-item"><a class="nav-link" href="/community/">
            Community</a></li>
        
        
        
        
        
        <li class="nav-item"><a class="nav-link" href="/token/">
            Token</a></li>
        
        
        
        <li class="nav-item"><a class="nav-link" href="/tools/">
            Tools</a></li>
        
        
        
        
        
        <li class="nav-item"><a class="nav-link" href="/block-production/">
            Block Production</a></li>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <li class="nav-item"><a class="nav-link" href="/news/index.html">
            News</a></li>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown"
            role="button" data-toggle="dropdown" aria-haspopup="true"
            aria-expanded="false">
            <img src="/assets/flags/en.png" />
          </a>
          <div class="dropdown-menu" aria-labelledby="navbarDropdown">
            
             
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
          </div>
        </li>
      </ul>
      <span class="navbar-text nav-buttons">
        <a href="/why-vote/#voting-matters" class="btn solid light btn-raised scatter-vote-oneclick">
          Vote eosdacserver
        </a>
        <a href="https://members.eosdac.io/" class="btn outline light btn-raised">
          Member Client
        </a>
      </span>
    </div>
  </nav>
</header>
<main class="page-content main" style="padding:0;" aria-label="Content">
      <div class="">
        <div>
<div class="container">
<div class="row" style="margin-top: 20px;">
<div class="col-md-12">
<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">eosDAC 토큰의 스냅샷에 앞서 EOS 토큰 홀더를 위한 공지 사항</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2018-03-27T18:23:45+05:30" itemprop="datePublished">Mar 27, 2018
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <center>![main](https://steemitimages.com/0x0/https://steemitimages.com/DQmWBAyqcW3GTJi3e65pzLcnMiAddAomTaXz7zwVmA19mM6/eosDAC.png)</center>

<center> **eosDAC 토큰의 스냅샷에 앞서 EOS 토큰 홀더를 위한 공지 사항**</center>

<p>안녕하세요, eosDAC은 선구적인 DAC 기반의 EOS 블록 프로듀서 후보로써 현 시점에는 3개 대륙에 거주 중인 12명의 ‘론칭 팀’에 의해 자치화 운영되고 있으며, 6월 초에 탈중앙 자율화 커뮤니티 개념의 DAC으로서 출범하려고 준비 중에 있습니다. DAC은 토큰 홀더의 소유하에 운영되는 것이 중추적인 이념이기 때문에 eosDAC은 총 토큰의 75%를 전 세계의 EOS 토큰 홀더에게 직접 에어드랍할 예정입니다. 시작에서부터 eosDAC은 커뮤니티가 중심인 EOS 블록 프로듀서인 것입니다. EOS 토큰 홀더의 전체적인 스냅샷은 세계협정시 4월 15일 오전 1시 (한국 시간으로는 오전 10시)에 이루어지며, 이 시점의 EOS 토큰 보유량에 따라 1:1 비율로 eosDAC 토큰을 에어드랍할 예정입니다. eosDAC 토큰의 실질적인 에어드랍은 4월 말 - 5월 초에 걸쳐 이루어질 계획입니다.</p>

<center>![catcher](https://steemitimages.com/0x0/https://steemitimages.com/DQmRvPf1JvTdxnpC5u1nZqSxX4Koqqx643xugEy2JJKSKvp/eosdacdream2.png)</center>

<p><strong>eosDAC 토큰을 받으려면 어떻게 합니까?</strong></p>

<p>EOS 토큰을 100개 이상 가지고 있으며 이를 본인의 프라이빗 키로 통제하는 월렛(하드웨어 월렛, 마이 이더월렛, 메타 마스크 등)에 보유하신 상태이면 EOS 토큰을 자동적으로 받을 수 있고 이외의 추가적인 절차는 없습니다.</p>

<p>만약 EOS 토큰을 100개 미만으로 보유하고 계시며 이를 본인의 프라이빗 키로 통제하는 월렛에 보관하고 계시다면 공식 웹사이트의 뉴스레터를 구독하셔서 스냅샷 후에 토큰의 지급 방법에 대하여 안내 받으시기 바랍니다.</p>

<p><strong>EOS를 거래소에 보관 중이라면?</strong></p>

<p>EOS 토큰을 암호화폐 거래소에 보관 중이라면 eosDAC 토큰을 자동적으로 받으실 수 없습니다. 받을 수 있는 방법은 두 가지가 있습니다.  첫 번째 방법은 토큰을 프라이빗 키를 소유하고 있는 월렛으로 옮기는 것이고, 두 번째 방법은 거래하고 계신 거래소에 직접 연락하여 향후 해당 거래소가 에어드랍된 eosDAC 토큰을 개인 계좌로 지급할 것인지에 대해 문의하는 것입니다. 이 글을 작성하고 있는 현재 업비트(Upbit, EOS 거래량으로는 2번째로 큰 거래소)만 4월 15일에 업비트 자체적으로 스냅샷을 찍을 것이며, 이를 통해 받은 eosDAC 토큰을 추후 고객들에게 분배할 의사가 있음을 공식적으로 알린 상태입니다. (정확한 내용은 업비트 공지를 확인하세요: https://steemkr.com/kr/@pliton/20180322t093607576z) 4월 15일 스냅샷 이전에 지급을 공개적으로 공지하지 않은 거래소는 eosDAC 토큰을 지급하지 않겠다는 것과 마찬가지이기 때문에 타 거래소에 EOS 토큰을 보유하고 계신 분들께서는 직접 거래소에 문의 상담을 하시고 개인의 eosDAC 토큰이 분배될 수 있도록 요청하시기 바랍니다. 문의 작성 내용을 고민하시는 분들을 위해 다음의 예시 고객 상담 메일/카톡 메시지를 준비하였습니다:
<strong>__</strong><strong>__</strong><strong>__</strong>___
거래소 관계자 분께,</p>

<p>안녕하세요. 저는 현재 해당 거래소에 EOS 토큰을 보유 중입니다. 4월 15일 세계협정시  오전 1시 (한국 시간 오전 10시)에  EOS 블록 프로듀서 후보인 eosDAC(https://eosdac.io/ko)이 총 토큰의 75%을 전 세계 EOS 토큰 홀더에게 1:1 비율로 에어드랍할 예정입니다. 혹시 본 거래소에서 이 스냅샷을 자체적으로 시행하는지,  그렇다면 후에 4월 초/5월 말에 eosDAC이 거래소에 에어드랍되었을 때 고객 계좌로 토큰을 지급할 것인지에 대해 공지 바랍니다. 만약 해당 거래소에서 eosDAC의 에어드랍과 토큰 지급을 지원하지 않는다면 저는 거래소 월렛에 보관하고 있는 EOS 토큰을 4월  15일 이전에 eosDAC 토큰을 지원하는 다른 거래소나 프라이빗 키의 개인 월렛으로 옮길 생각입니다.</p>

<p>회신바랍니다. 감사합니다.
<strong>__</strong><strong>__</strong><strong>__</strong>___</p>

<p>eosDAC뉴스레터 구독과 함께 에어드랍된 eosDAC 토큰을 지원하는 각 거래소의 공지 소식을 전해드리고자 합니다. 거래소 지원 목록 또한 토큰 페이지에 추가하였으니 참고 바랍니다. http://eosdac.io/ko/tokens</p>

<center>![icon](https://steemitimages.com/0x0/https://steemitimages.com/DQmPerknmqTDcsagXjERkitKthcr2anHRDSTJ85EDBhhkqW/eosdac2alogo28.png)</center>

<p><strong><img src="url" alt="eosDAC에 관하여.." /></strong></p>

<p>eosDAC의 비전은 누구나 EOS.IO 블록 생산에 참여하고 혜택을 받을 수 있도록 블록 생산이 개방되는 것입니다. 이러한 비전을 실현하기 위해 eosDAC는 탈중앙 자율화 커뮤니티로서 전 세계의 EOS 생태계에 이바지하는 선구적인 EOS.IO 블록 프로듀서가 되기 위해 노력하겠습니다. 이를 위해 eosDAC은 서비스 제공에 필요한 툴과 스마트 계약을 생성할 것이며, 또 이를 EOS 커뮤니티와 공유해 다른 DAC의 출범을 도우며 EOS.IO 블록 체인의 생태계를 활성화시킬 것입니다.  eosDAC는 현재 운영 시설을 확장 중이며 5월 말 전에 구동 단계 완료 예정입니다. 주요 전략은 영국, 루마니아, 지브롤터 및 한국에 이르기까지 광범위한 지리적 관할 구역에 블록 생산 인프라를 달성하는 것입니다. 론칭 팀은 데이터 센터 운영 및 Tier 1 인터 네트워킹 설계 및 이행에 대한 노하우를 보유하여 네트워크 구조의 대기 시간 최적화, 효율성 극대화, 견고한 리던던시를 보장하고자 합니다.</p>

<p>eosDAC의 거버넌스는 EOS의 메인넷 블록체인 출시까지 BlockMaker Ltd.가 임명한 론칭 팀에게 위탁됩니다. 그리고 EOS.IO 블록체인 블록 생산자로서 eosDAC의 성공적인 출범과 동시에 토큰 홀더는 론칭 팀의 운영 로드맵을 직접적일지 아니면 간접적인 거버넌스로 향할지에 대해 투표를 통해 선택합니다.</p>

<p>자세한 사항은 eosDAC 한국 텔레그램 그룹을 방문하셔서 문의하실 수 있습니다 : https://t.me/eosdac_korea 
<strong>__</strong><strong>__</strong><strong>__</strong>___</p>

<center>#EOS #eosDAC #UPbit #snapshot #exchanges #airdrop #Korea #news #EOSIO #blockproducer #EOSToken #EOSBlockchain #crypto #cryptocurrency #cryptocurrencies #register #coins #tokens #guide #smartcontract #exchange</center>

  </div><a class="u-url" href="/2018/03/27/eosdac-eos.html" hidden></a>
</article>

  <a href="https://steemit.com/snapshot/@eosdac/eosdac-eos">Read more ↗</a><br/><br/>


<a href="/news">Back</a>
</div>
</div>
</div><div style="background-image:url(/assets/footer-bkgr.png);background-repeat:no-repeat;background-size:100% auto;margin-top:50px;">
    <img src="/assets/spacer.gif" style="width:100%;"/>
</div></div>
      </div>
    </main><footer class="site-footer h-card" style="border:0;padding:0;">
  <div class="footer">

    <div class="container">
      <div class="row">
        <div class="col-md-3">
          <h2 id="important-links">Important Links</h2>
<p><a href="/why-vote/#core-principles">Code Of Conduct</a><br />
<a href="/history/">eosDAC History</a><br />
<a href="https://eosdac.zendesk.com/">Help Center</a><br />
<a href="/styleguide">Styleguide</a><br />
<a href="https://steemit.com/eos/@eosdac/statement-of-ownership-and-code-of-conduct">Disclosures</a><br />
<a href="/bp.json">BP Info</a></p>

        </div>
        <div class="col-md-6">
          <h2 id="newsletter">Newsletter</h2>

          <form id="newsletterForm">
    <div class="row">
        <div class="col-md-6">
            <div class="form-group">
                <label for="name" class="bmd-label-floating">
                    Name
                </label>
                <input type="text" class="form-control" id="name" name="name">
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
                <label for="email" class="bmd-label-floating">
                    Email *
                </label>
                <input type="email" class="form-control" id="email" name="email"
                    required>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <select class="form-control" id="language" name="language" required>
                <option value="">Language *</option>
                <option value="English">&nbsp;&nbsp;&nbsp;&nbsp;English</option>
                <option value="Russian">&nbsp;&nbsp;&nbsp;&nbsp;Pусский</option>
                <option value="Korean">&nbsp;&nbsp;&nbsp;&nbsp;한국어</option>
                <option value="Chinese">&nbsp;&nbsp;&nbsp;&nbsp;简体中文</option>
            </select>
        </div>
        <div class="col-md-6">
            <button type="submit" id="submitButton" class="btn">
                Subscribe
            </button>
        </div>
    </div>
</form>
<script>
$('#newsletterForm').submit(function(event) {
    event.preventDefault();
    $.post('https://toolkit-api.eosdac.io/subscribe', $(this).serialize())
    .done( function(result) {
        if(result && (result.message === 'subscribed_successfully' || result.message === 'already_subscribed')) {
            alert('Thank you, your records have been updated!');
            document.getElementById('newsletterForm').reset();
        } else {
            alert('Error:\n'+JSON.stringify(result));
        }
    })
    .fail( function(xhr, textStatus, errorThrown) {
        alert('Error '+xhr.status+':\n'+xhr.responseText);
    });
});
</script>
        </div>
        <div class="col-md-3">
          <h2 id="social-media">Social Media</h2>
<p><a href="https://discord.io/eosdac"><i class="icon icon-social-discord-com"></i></a>
<a href="https://github.com/eosdac"><i class="icon icon-social-github-com"></i></a>
<a href="https://steemit.com/@eosdac"><i class="icon icon-social-steemit-com"></i></a>
<a href="https://twitter.com/eosdac"><i class="icon icon-social-twitter-com"></i></a>
<a href="https://www.instagram.com/eosdac"><i class="icon icon-social-instagram-com"></i></a>
<br />
<a href="https://facebook.com/eosdac"><i class="icon icon-social-facebook-com"></i></a>
<a href="https://www.reddit.com/r/eosdac"><i class="icon icon-social-reddit-com"></i></a>
<a href="https://vk.com/eosdac"><i class="icon icon-social-vk-com"></i></a>
<a href="https://www.linkedin.com/company/eosdac/"><i class="icon icon-social-linkedin-com"></i></a>
<a href="https://www.youtube.com/eosdac"><i class="icon icon-social-youtube-com"></i></a>
<br />
<a href="https://murmurdapp.com/userpost/eosdacmurmur"><i class="icon icon-social-murmur"></i></a>
<a href="https://t.me/eosdacio"><i class="icon icon-social-telegram"></i></a></p>

        </div>
      </div>
    </div>

    <div class="container">
      <hr style="padding: 10px 0; border-color: #BABDBE;" /><div class="row">
        <div class="col-md-2">
          <img src="/assets/signet-white.svg" height="50" alt="site.title">
        </div>
        <div class="col-md-10">
          
          
          
          
          <a class="nav-link" href="/why-vote/"
            style="text-transform: none; display: inline-block; margin-top: 5px;
            color: white;">Why Vote for eosDAC?</a>
          
          
          <a class="nav-link" href="/why-join/"
            style="text-transform: none; display: inline-block; margin-top: 5px;
            color: white;">Why Join eosDAC?</a>
          
          
          <a class="nav-link" href="/why-launch/"
            style="text-transform: none; display: inline-block; margin-top: 5px;
            color: white;">Why Launch a DAC?</a>
          
          <a class="nav-link" href="/community/"
            style="text-transform: none; display: inline-block; margin-top: 5px;
            color: white;">Community</a>
          
          
          <a class="nav-link" href="/token/"
            style="text-transform: none; display: inline-block; margin-top: 5px;
            color: white;">Token</a>
          
          <a class="nav-link" href="/tools/"
            style="text-transform: none; display: inline-block; margin-top: 5px;
            color: white;">Tools</a>
          
          
          <a class="nav-link" href="/block-production/"
            style="text-transform: none; display: inline-block; margin-top: 5px;
            color: white;">Block Production</a>
          
          
          
          
          
          
          
          
          
          <a class="nav-link" href="/news/index.html"
            style="text-transform: none; display: inline-block; margin-top: 5px;
            color: white;">News</a>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          </div>
      </div></div>
  </div>
</footer>
<script src="https://vjs.zencdn.net/7.4.1/video.js"></script>
<script src="/assets/videojs-resolution-switcher.js"></script>
<script src="https://unpkg.com/popper.js@1.12.6/dist/umd/popper.js"
  integrity="sha384-fA23ZRQ3G/J53mElWqVJEGJzU0sTs+SvzG8fXVWP+kJQ1lwFAOkcUOysnlKJC33U"
  crossorigin="anonymous"></script>
<script
  src="https://unpkg.com/bootstrap-material-design@4.1.1/dist/js/bootstrap-material-design.js"
  integrity="sha384-CauSuKpEqAFajSpkdjv3z9t8E7RlpJ1UP0lKM/+NdtSarroVKu069AlsRPKkFBz9"
  crossorigin="anonymous"></script>
<script>
$(document).ready(function() {
  $('body').bootstrapMaterialDesign()
  //initialize video players on why-join page
  videojs('why-join-video-1', null, function() {
    var player = this
    window.player = player
    player.on('fullscreenchange', function() {
      if(player.isFullscreen()) {
        label='SD'
        if(screen.width>1280) label='HD'
        player.currentResolution(label)
      } else
        player.currentResolution('SD')
    })
  }).videoJsResolutionSwitcher()
  videojs('why-join-video-2', null, function() {
    var player = this
    window.player = player
    player.on('fullscreenchange', function() {
      if(player.isFullscreen()) {
        label='SD'
        if(screen.width>1280) label='HD'
        player.currentResolution(label)
      } else
        player.currentResolution('SD')
    })
  }).videoJsResolutionSwitcher()
  videojs('why-join-video-3', null, function() {
    var player = this
    window.player = player
    player.on('fullscreenchange', function() {
      if(player.isFullscreen()) {
        label='SD'
        if(screen.width>1280) label='HD'
        player.currentResolution(label)
      } else
        player.currentResolution('SD')
    })
  }).videoJsResolutionSwitcher()
})
</script>
<!-- Voting Modal -->
<div class="modal fade" id="votingModal" tabindex="-1" role="dialog" aria-labelledby="votingModalLabel" aria-hidden="true">
<div class="modal-dialog" role="document">
    <div class="modal-content">
    <form id="votingForm">
    <div class="modal-header">
        <h5 class="modal-title" id="votingModalLabel">You already selected 30 BPs</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
            Free up one spot, to cast a vote for <code class="highlighter-rouge">eosdacserver</code>
        <br/><br/>
        <div class="container-fluid">
            <div class="row">
                <div class="col-6" style="padding:0;padding-right:10px;" id="voting_col1">
                    <!-- Will be filled via Javascript -->
                </div>
                <div class="col-6" style="padding:0;"  id="voting_col2">
                    <!-- Will be filled via Javascript -->
                </div>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <div style="padding: 0 16px;">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
            <button type="submit" class="btn solid dark btn-raised">Vote now</button>
        </div>
    </div>
    </form>
    </div>
</div>
</div>

<script src="/assets/eosjs/eosjs-api.js?1586616978"></script>
<script src="/assets/eosjs/eosjs-jsonrpc.js?1586616978"></script>
<script src="https://cdn.scattercdn.com/file/scatter-cdn/js/latest/scatterjs-core.min.js?1586616978"></script>
<script src="https://cdn.scattercdn.com/file/scatter-cdn/js/latest/scatterjs-plugin-eosjs2.min.js?1586616978"></script>
<script src="https://cdn.scattercdn.com/file/scatter-cdn/js/latest/scatterjs-plugin-lynx.min.js?1586616978"></script>
<script type="text/javascript">
// This file needs to be included via the LIQUID template engine, in order to make the translations work!

// Here is how to calculate the vote decay
// https://github.com/eosdac/eosdactoolkit/blob/master/eosdac-material/src/components/vote-eosdac.vue#L126
// https://github.com/eosdac/eosdactoolkit/blob/master/eosdac-material/src/components/vote-eosdac.vue#L169

const host = 'public.eosinfra.io' //TODO: use eu.eosdac.io instead? -> CORS problem
const network = {
    blockchain:'eos',
    protocol:'https',
    host,
    port:443,
    chainId:'aca376f206b8fc25a6ed44dbdc66547c36c6c33e3a119ffbeaef943642f0e906'
}
const EOSDACSERVER = 'eosdacserver'

function castVote(api, account, producers, proxy = "") {
    const transaction = {
        actions: [{
            account: 'eosio',
            name: 'voteproducer',
            authorization: [{ actor: account.name, permission: account.authority, }],
            data: { producers: producers.sort(), proxy, voter: account.name }
        }]
    }
    return api.transact(transaction, { blocksBehind: 3, expireSeconds: 30 })
}

function errHandler(scatter, target, originalContent, err, showAlert = true) {
    console.error('Voting error:', err)
    target.textContent = originalContent
    scatter.logout()

    // Do not show an alert() if the user rejected the transaction on purpose
    const rejected = ['signature_rejected', 'identity_rejected', 'Request Canceled']
    if(err &&  (rejected.includes(err.type) || rejected.includes(err.message))) {
        showAlert = false
    }
    if(showAlert) alert('Error: ' + JSON.stringify(err))
}

function succHandler(scatter, target, msg = 'Thanks for voting!') {
    target.textContent = msg
    scatter.logout() //all done, goodbye!
}

function oneClickVote(scatter, target, originalContent) {
    target.textContent = 'Voting...'

    const rpc = new eosjs_jsonrpc.JsonRpc('https://'+host)
    const api = new eosjs_api.Api({ rpc, signatureProvider:scatter.eosHook(network, null, true) })

    scatter.login({ accounts: [network] }).then(function() {
        const account = scatter.identity.accounts.find(x => x.blockchain === 'eos')
        /*
        We could also use get_table_rows() to get the voter_info,
        but need to make sure that the result is for 'account.name'.
        get_table_rows({
            json: true,
            code: 'eosio',
            scope: 'eosio',
            table: 'voters',
            lower_bound: account.name,
            limit: 1
        })
        */
        api.rpc.get_account(account.name).then(function(data) {
            const vote = data.voter_info
            let proxy = ''
            let producers = []
            // If vote (e.g. account.voter_info) is 'null', the eosio.voters table is empty for this account,
            // i.e. the account never voted before: Just vote for ['eosdacserver'] in this case!
            if(vote !== null) {
                proxy = vote.proxy
                producers = vote.producers
            }
            if(proxy !== '') {
                api.rpc.get_account(proxy).then(function(data) {
                    if(data && data.voter_info && data.voter_info.is_proxy === 1) {
                        const proxy_producers = data.voter_info.producers
                        const eosdacserverVoted = proxy_producers.some(function(bpName) { return bpName === EOSDACSERVER })
                        if(eosdacserverVoted === true) {
                            // Re-cast vote for the current proxy
                            castVote(api, account, [], proxy).then(function(result) {
                                succHandler(scatter, target, 'Voted proxy: ' + proxy)
                            }).catch(function(err) {
                                errHandler(scatter, target, originalContent, err)
                            })
                        } else {
                            // Re-cast vote for the current proxy, but notify user that it does not support eosdacserver
                            castVote(api, account, [], proxy).then(function(result) {
                                succHandler(scatter, target, 'Voted proxy: ' + proxy)
                                alert(proxy + ' does not support eosDAC. Please consider another proxy!')
                            }).catch(function(err) {
                                errHandler(scatter, target, originalContent, err)
                            })
                        }
                    } else {
                        errHandler(scatter, target, originalContent, proxy+" isn't a proxy anymore")
                        alert(proxy + ' is not a proxy anymore. Please choose another proxy!')
                    }
                }).catch(function(err) {
                    errHandler(scatter, target, originalContent, err)
                })
            } else {
                // Check status of all selected producers, e.g. if they are still registered
                Promise.all(producers.map(p => api.rpc.get_producers(true, p, 1))).then(function(responses) {
                    const reg_producers = responses.map(r => r.rows[0].owner)
                    let new_producers = []
                    // Add all selected AND registered producers into the new_producers array
                    producers.forEach(p => {
                        if(reg_producers.some(rp => rp === p)) new_producers.push(p)
                    })
                    producers = new_producers
                    const eosdacserverVoted = producers.some(function(bpName) { return bpName === EOSDACSERVER })
                    if(eosdacserverVoted === true) {
                        // Re-cast vote for current set of producers (including eosdacserver)
                        castVote(api, account, producers).then(function(result) {
                            succHandler(scatter, target)
                        }).catch(function(err) {
                            errHandler(scatter, target, originalContent, err)
                        })
                    } else {
                        if(producers.length < 30) {
                            // Add 'eosdacserver' to producers list and cast a vote
                            producers.push(EOSDACSERVER)
                            castVote(api, account, producers).then(function(result) {
                                succHandler(scatter, target)
                            }).catch(function(err) {
                                errHandler(scatter, target, originalContent, err)
                            })
                        } else {
                            // Show a modal dialog, to let the user remove one existing producer
                            // Set values inside the modal dialog
                            $('#voting_col1').empty()
                            $('#voting_col2').empty()
                            producers.sort().forEach(function(bpName, idx) {
                                const itm = '<div class="custom-control custom-checkbox"><input type="checkbox" class="custom-control-input" name="bp'+idx+'" id="bp'+idx+'" value="'+bpName+'" checked><label class="custom-control-label" style="font-family:monospace;" for="bp'+idx+'">'+bpName+'</label></div>'
                                if(idx < 15) {
                                    $(itm).appendTo('#voting_col1')
                                } else {
                                    $(itm).appendTo('#voting_col2')
                                }
                            })
                            // Register the submit callback, using local variables
                            $('#votingForm').submit(function(ev) {
                                ev.preventDefault()
                                const producers = $("#votingForm").serializeArray().map(function(elem) {
                                    return elem.value
                                })
                                // Add 'eosdacserver' to producers, if user removed one other producer
                                if(producers.length < 30) {
                                    producers.push(EOSDACSERVER)
                                }
                                castVote(api, account, producers).then(function(result) {
                                    $('#votingModal').modal('hide')
                                    succHandler(scatter, target)
                                }).catch(function(err) {
                                    $('#votingModal').modal('hide')
                                    errHandler(scatter, target, originalContent, err)
                                })
                            })
                            // Register the modal's Cancel/Hide handler, using local variables
                            $('#votingModal').on('hide.bs.modal', function (e) {
                                errHandler(scatter, target, originalContent, 'Modal cancelled/hidden.')
                            })
                            // Show the voting modal
                            $('#votingModal').modal('show')
                        }
                    }
                }).catch(function(err) {
                    errHandler(scatter, target, originalContent, err)
                })
            }
        }).catch(function(err) {
            errHandler(scatter, target, originalContent, err)
        })
    }).catch(function(err) {
        errHandler({ logout: function() { /* Scatter not signed in */ }}, target, originalContent, err)
    })
}

function adoptAuthenticatorByUseragent(idx, obj) {
    const originalContent = obj.textContent
    if(originalContent.includes('Scatter')) {
        const UA = window.navigator.userAgent
        // Detect EOS Lynx according to: https://developers.eoslynx.com/mobile
        if(UA === 'EOSLynx IOS' || UA === 'EOSLynx Android') {
            obj.textContent = originalContent.replace('Scatter', 'EOS Lynx')
            console.info('Adopted for EOSLynx.')
        }
    }
}

$(document).ready(function() {
    ScatterJS.plugins( new ScatterEOS(), new ScatterLynx({ Api: eosjs_api.Api, JsonRpc: eosjs_jsonrpc.JsonRpc }) )
    ScatterJS.scatter.connect('eosDAC.io').then(function( connected ) {
        if(!connected) {
            console.error('Scatter could not be found.')
            return false
        }

        // Scatter was successfully connected
        const scatter = ScatterJS.scatter
        //window.ScatterJS = null
        console.info('Scatter connected.')

        // Setup the click handler for '.scatter-vote-oneclick' links
        // and prevent their default (fallback) link/button behaviour,
        // i.e. do not follow their 'href'
        $('.scatter-vote-oneclick').click(function(ev) {
            ev.preventDefault()
            const target = ev.target
            const originalContent = target.textContent
            oneClickVote(scatter, target, originalContent)
        })
        console.info('Scatter handler registered.')

        // Adopt 'Vote using Scatter' button to 'Vote using EOS Lynx' if applicable
        $('.scatter-vote-oneclick').each(adoptAuthenticatorByUseragent)
    })
})
</script>
</body>

</html>
