<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>
    
      eosDAC | 
    
  </title>
  <meta property="og:title" content="eosDAC">
  <meta property="og:site_name" content="eosDAC">
  <meta name="description" content="The Community-Owned EOS Block Producer and DAC Enabler">
  <meta property="og:description" content="The Community-Owned EOS Block Producer and DAC Enabler">
  <link rel="shortcut icon" type="image/png" href="/assets/favicon.png?1586730102">
  <link href="/assets/styles.css?1586730102s" rel="stylesheet">
  <link href="https://vjs.zencdn.net/7.4.1/video-js.css" rel="stylesheet">
  <link rel="stylesheet" href="/assets/videojs-resolution-switcher.css">
  <link rel="stylesheet"
    href="https://unpkg.com/bootstrap-material-design@4.1.1/dist/css/bootstrap-material-design.min.css"
    integrity="sha384-wXznGJNEXNG1NFsbm0ugrLFMQPWswR3lds2VeinahP8N0zJw9VWSopbjv2x7WCvX"
    crossorigin="anonymous">
  <link rel="stylesheet" href="/assets/bootstrap-material-design-overwrite.css?1586730102">
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css?family=Roboto:100,200,300,400,500,600">
  <link rel="stylesheet" href="/assets/main.css?1586730102">
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="crossorigin="anonymous"></script><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="site.title" /><link rel="alternate" hreflang="en" href="https://eosdac.io">
  <link rel="alternate" hreflang="ko" href="https://eosdac.io/ko/">
  <link rel="alternate" hreflang="zh-hans" href="https://eosdac.io/zh-hans/">
  <link rel="alternate" hreflang="vi" href="https://eosdac.io/vi/">
  <link rel="alternate" hreflang="ja" href="https://eosdac.io/ja/">
  <link rel="alternate" hreflang="es" href="https://eosdac.io/es/">
  <link rel="alternate" hreflang="ru" href="https://eosdac.io/ru/">
  <link rel="canonical" href="https://eosdac.io/">
  <script src="/assets/vconsole.min.js"></script>
  <script>
    // Init vConsole, if the ?debug=true parameter exists
    if(window.location.search.substr(1).indexOf('debug=true') >= 0) {
      var vConsole = new VConsole()
    }
  </script>
</head>
<body><header class="site-header" role="banner" style="border:0">
  <nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark nav-tabs"
    style="background-image:linear-gradient(to right, #4A1289, #7C41BA)">
    <a class="navbar-brand" href="/">
      <img src="/assets/signet-white.svg" height="42" alt="eosDAC">
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse"
      data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false"
      aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav mr-auto">
        
        
        
        
        
        
        <li class="nav-item"><a class="nav-link" href="/why-vote/">
            Why Vote for eosDAC?</a></li>
        
        
        
        
        
        <li class="nav-item"><a class="nav-link" href="/why-join/">
            Why Join eosDAC?</a></li>
        
        
        
        
        
        <li class="nav-item"><a class="nav-link" href="/why-launch/">
            Why Launch a DAC?</a></li>
        
        
        
        <li class="nav-item"><a class="nav-link" href="/community/">
            Community</a></li>
        
        
        
        
        
        <li class="nav-item"><a class="nav-link" href="/token/">
            Token</a></li>
        
        
        
        <li class="nav-item"><a class="nav-link" href="/tools/">
            Tools</a></li>
        
        
        
        
        
        <li class="nav-item"><a class="nav-link" href="/block-production/">
            Block Production</a></li>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <li class="nav-item"><a class="nav-link" href="/news/index.html">
            News</a></li>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown"
            role="button" data-toggle="dropdown" aria-haspopup="true"
            aria-expanded="false">
            <img src="/assets/flags/en.png" />
          </a>
          <div class="dropdown-menu" aria-labelledby="navbarDropdown">
            
             
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
          </div>
        </li>
      </ul>
      <span class="navbar-text nav-buttons">
        <a href="/why-vote/#voting-matters" class="btn solid light btn-raised scatter-vote-oneclick">
          Vote eosdacserver
        </a>
        <a href="https://members.eosdac.io/" class="btn outline light btn-raised">
          Member Client
        </a>
      </span>
    </div>
  </nav>
</header>
<main class="page-content main" style="padding:0;" aria-label="Content">
      <div class="">
        <div>
<div class="container">
<div class="row" style="margin-top: 20px;">
<div class="col-md-12">
<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">eosDAC 에어드랍 내역 및 소각 완료</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2018-05-21T03:58:39+05:30" itemprop="datePublished">May 21, 2018
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>eosDAC의 비전은 모두가 EOS.IO 블록 생산에 참여할 수 있고 혜택을 받도록 개방되는 것입니다. 이러한 비전을 실현하기 위해 eosDAC는 성장하는 탈중앙 자율화 커뮤니티로서 전 세계의 EOS 커뮤니티에 이바지하는 선도적인 EOS.IO 블록 프로듀서가 되기 위해 노력할 것입니다. 이러한 방편으로 eosDAC은 서비스 제공에 필요한 댑과 스마트 계약을 만들고 이를 EOS 커뮤니티와 공유해 EOS.IO 블록 체인의 DAC 생태계를 활성화할 것 입니다.</p>

<p>eosDAC은 EOS 토큰 홀더들이 커뮤니티 개발에 참여할 수 있게끔 75%에 달하는 eosDAC 토큰을 EOS 분배에 맞추어 에어드랍하기로 하였습니다.</p>

<p><img src="https://steemitimages.com/DQmZtFLFYGepaxhCJ3A95CBauY1Zch4y7rPcz5YSWFTenQX/airdrop1.png" alt="airdrop1.png" /></p>

<p>론칭팀은 6월 이오스 론칭 전에 eosDAC 토큰을 배포하여 커뮤니티를 활성화할 필요를 느끼고 세계협정시 2018년 4월 15일 새벽 1시를 컷오프 기점으로 정하였습니다.그 이유는 이 날로 EOS 토큰이 9억 개째 분배되기 때문입니다. 따라서 EOS 토큰량과도 맞출 수 있으며 또 론칭 전 에어드랍을 완료할 시간과 커뮤니티 구축에 할애할 시간을 충분히 확보할 수 있을 거라고 판단했기 때문입니다</p>

<h1 id="준비에-거쳐야-하는-도전-과제">준비에 거쳐야 하는 도전 과제</h1>

<p>EOS를 보유한 지갑 주소는 약 30만 개에 달하며 모든 지갑에 에어드랍을 성공적으로 마치기 위해 시간이 여유롭지 않은 점이 있었습니다. 또한, 이더리움 네트워크상 필요한 가스 이더가 상당히 많이 소요된다는 점이 있었습니다.</p>

<p>분석 결과에 의하면 20만 개의 주소는 100개 미만의 EOS를 소유하고 있었고 이는 분배된 EOS 토큰의 약 0.5%에 해당하였습니다. 100개 이상의 EOS를 소지한 지갑에 한해 에어드랍을 제공한다는 논의도 있었으나 모든 EOS 소지 지갑 홀더들을 포함한다는 eosDAC의 비전에 따라 100개 미만의 토큰 홀더들도 토큰을 신청해 받을 수 있는 프로세스가 마련되어 실행되었습니다.</p>

<p>수많은 지갑 주소에 특정량의 갯수를 에어드랍하기 위해서는 회계적인 절차가 필요하였고 전송마다 생성되는 트랜잭션 해시를 기록하는 방법을 사용하기로 했습니다. 이더리움 네트워크 사용 시에 개별적인 전송에 걸리는 시간이 일괄적인 전송으로 줄어들 수 있었고 시간상으로 연체되지 않는 한 훨씬 효율적이었고 테스팅 결과 50개씩 일괄적인 전송이 가장 적합하였습니다.</p>

<p><img src="https://steemitimages.com/DQmZMrvPHpAkkx4WvMxXGWQMqQESjXtLAxf5hztrnZWbCrk/dreamstime_m_27008957.jpg" alt="dreamstime_m_27008957.jpg" /></p>

<p>EOS 토큰의 스냅샷을 위해 론칭팀은 Block.one의 오픈소스 스냅샷 툴을 사용하기로 하였습니다. 이 과정에서 한 달 이전에 미리 스냅샷 테스팅을 통해 검증을 거쳤고 eosDAC의 성공적인 에어드랍은 Block.One의 스냅샷 툴이 유용한 자원이라는 것을 직접 인증한 모범 사례라고 할 수 있겠습니다.</p>

<p>대부분 EOS 토큰을 다량 보유한 지갑은 거래소 소유였고 에어드랍된 토큰을 지급해주지 않는 거래소에 분배하는 것 또한 풀어야 할 문제였습니다. 거래소가 토큰을 버리거나 덤핑 또는 자체적인 소유로 만들어 버릴 우려도 있었고 이러한 과제들을 위해 커뮤니티에 두 가지의 도움을 요청하기로 했습니다. 첫 번째는 바로 커뮤니티 회원들이 직접 거래소에 에어드랍 지원을 촉구하는 캠페인 운동이었고 두 번째는 에어드랍을 지원하지 않는 거래소의 지갑 주소를 감별하는 것이었습니다. 추가로 스냅샷이 실시되기 이전에 eosDAC 에어드랍을 지원하지 않는 거래소에서 EOS 토큰을 이전하기를 커뮤니티에 권장하였습니다.</p>

<h1 id="스냅샷과-에어드랍">스냅샷과 에어드랍</h1>

<p><img src="https://steemitimages.com/DQmUPMkjqRMrjb9bCbiANBTH9UPgNqVz5KPW4NkGGLLedDd/snapshot.jpg" alt="snapshot.jpg" /></p>

<p>EOS 토큰 분배 300일째가 되는 날, 스냅샷 툴은 이더리움 블록 5442134의(https://etherscan.io/block/5442134) EOS 분배 정황을 기록하기 시작하였습니다. 분배 기록이 담긴 파일 중 다량의 정보가 담긴 샘플을 통해 스냅샷 결과가 http://etherscan.io 의 지갑 내역 정보와 일치하는지 확인하였고 소소한 에러를 사건별로 처리하고 에어드랍 도중 발생하는 문제점들을 극복하기 위해 위험요소가 적은 EOS 소량 보유의 지갑들부터 에어드랍을 하였습니다.</p>

<p>에어드랍 지급 파일은 50개 단위로 짜였으며 web3.js를 통해 생성한 트랜잭션 스크립트들이 사용되었습니다. 뱃치 스크립트를 다수의 노드에서 실행할 수 있었으나 다수는 일련적으로 실행되고 난 후 확인 단계를 거치고서야 다음 뱃치 스크립트로 넘어가곤 하였습니다.</p>

<p><img src="https://steemitimages.com/DQmSGjhCqhGxUNXdtVcwss4v2o1mxjbc2ENRBaYBJdQZGzV/tokenpulse.jpg" alt="tokenpulse.jpg" /></p>

<p>각 뱃치 스크립트는 트랜잭션마다 확인 가능한 로그를 생성하였고 여기에는 이더리움 주소, 토큰 양, 트랜잭션 해시, 블록/블록 해시, 사용된 가스양이 포함되었으며 이 로그 기록은 깃헙 저장소에 업로드되었습니다: https://github.com/eosdac/airdrop</p>

<p>이더리움 네트워크의 지연으로 생기는 타임아웃의 경우 수동적으로 확인한 다음 실패한 트랜잭션을 재시도하였습니다. 가스 값어치는 유동적으로 http://www.ethgasstation.info 를 확인하여 트랜잭션에 필요한 최저치를 사용하였고 에어드랍 전체에 든 이더리움은 약 30개에 달하며 이 에어드랍을 통해 다량의 트랜잭션을 실행하는데 이더리움이 겪는 난제들이 확연히 나타났습니다. 하지만 eosDAC 토큰이 EOS 체인으로 이전하는 데는 훨씬 더 신속히 처리되리라 전망합니다.</p>

<p>대략 4000개의 지갑 주소에서 100개 미만의 eosDAC 토큰을 신청하는 문의를 하였으며 주기적으로 토큰 전송이 이루어졌으며 마지막 부분까지 신속히 처리하였습니다.</p>

<h1 id="거래소와의-관계">거래소와의 관계</h1>

<p><img src="https://steemitimages.com/DQmYibKb53nbojCD7LJofeGyxm5RmN9dKCEwPNptVksXwrW/exchanges.jpg" alt="exchanges.jpg" /></p>

<p>eosDAC 커뮤니티와 론칭팀은 블록원이나 에어드랍을 지원하지 않는 거래소 지갑 주소를 약 48개 확인하였으며 해당 주소로 에어드랍을 보류하였습니다. 대다수의 거래소는 거래소 고객들에게 에어드랍된 eosDAC 토큰을 지급하였으며 eosDAC은 여기에 대해 진심으로 감사의 뜻을 표하는 바 입니다.</p>

<p>거래소들과 에어드랍 절차를 조율하는 과정에서 예외적인 경우를 두어야할 경우가 있었습니다. 업비트의 경우 고객 소유의 EOS 토큰량에 대한 정보를 제공하여 확인한 후 거래소의 중앙 지갑 주소로 전송을 하였습니다. 후오비는 에어드랍 지원 공지를 하였지만, 고객 보호 차원에서 거래소 지갑 주소를 알려주지 않았습니다. 저희 쪽에서 후오비 소유의 지갑과 고객 지갑 주소를 다량 확인하였으나 후오비 측에서 문의해 온 에어드랍량과 일치하지 않았습니다. 후에 여러 차례의 논의와 조사를 걸쳐 후오비는 정말 고객들의 이익을 대변해 요청한 것이 확실하여 후오비에서 요청한 나머지 1,119,834개의 토큰도 에어드랍하였습니다.</p>

<h1 id="토큰-소각량과-결과">토큰 소각량과 결과</h1>

<p>약 99.9%의 트랜잭션은 성공적으로 전송되었으나 실수가 없지는 않았습니다. 한 뱃치는 로깅 구조의 문제로 반복되어 전송되었고 결과적으로 50개의 지갑 주소들이 eosDAC 토큰을 반복해 지급되었으며 44090개의 토큰이 초과 전송되었습니다.</p>

<p>에어드랍 결과 차트:</p>

<p><img src="https://steemitimages.com/DQmZy1aJcKvSK7iDu2ddyDzza9ZpDbTqRpc8WaXnuigSA6w/eosdacairdrop.png" alt="eosdacairdrop.png" /></p>

<p>위 차트에 의하면 총 238,080,898.455개의 토큰이 소각될 예정이며 곧이어 회수가 불가피한 0x0000000000000000000000000000000000e05dac 주소로 전송될 것입니다. 이후 순환되는 eosDAC 토큰은 총 961,919,101.545개입니다.</p>

  </div><a class="u-url" href="/2018/05/21/2vdmsj-eosdac.html" hidden></a>
</article>

  <a href="https://steemit.com/eos/@eosdac/2vdmsj-eosdac">Read more ↗</a><br/><br/>


<a href="/news">Back</a>
</div>
</div>
</div><div style="background-image:url(/assets/footer-bkgr.png);background-repeat:no-repeat;background-size:100% auto;margin-top:50px;">
    <img src="/assets/spacer.gif" style="width:100%;"/>
</div></div>
      </div>
    </main><footer class="site-footer h-card" style="border:0;padding:0;">
  <div class="footer">

    <div class="container">
      <div class="row">
        <div class="col-md-3">
          <h2 id="important-links">Important Links</h2>
<p><a href="/why-vote/#core-principles">Code Of Conduct</a><br />
<a href="/history/">eosDAC History</a><br />
<a href="https://eosdac.zendesk.com/">Help Center</a><br />
<a href="/styleguide">Styleguide</a><br />
<a href="https://steemit.com/eos/@eosdac/statement-of-ownership-and-code-of-conduct">Disclosures</a><br />
<a href="/bp.json">BP Info</a></p>

        </div>
        <div class="col-md-6">
          <h2 id="newsletter">Newsletter</h2>

          <form id="newsletterForm">
    <div class="row">
        <div class="col-md-6">
            <div class="form-group">
                <label for="name" class="bmd-label-floating">
                    Name
                </label>
                <input type="text" class="form-control" id="name" name="name">
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
                <label for="email" class="bmd-label-floating">
                    Email *
                </label>
                <input type="email" class="form-control" id="email" name="email"
                    required>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <select class="form-control" id="language" name="language" required>
                <option value="">Language *</option>
                <option value="English">&nbsp;&nbsp;&nbsp;&nbsp;English</option>
                <option value="Russian">&nbsp;&nbsp;&nbsp;&nbsp;Pусский</option>
                <option value="Korean">&nbsp;&nbsp;&nbsp;&nbsp;한국어</option>
                <option value="Chinese">&nbsp;&nbsp;&nbsp;&nbsp;简体中文</option>
            </select>
        </div>
        <div class="col-md-6">
            <button type="submit" id="submitButton" class="btn">
                Subscribe
            </button>
        </div>
    </div>
</form>
<script>
$('#newsletterForm').submit(function(event) {
    event.preventDefault();
    $.post('https://toolkit-api.eosdac.io/subscribe', $(this).serialize())
    .done( function(result) {
        if(result && (result.message === 'subscribed_successfully' || result.message === 'already_subscribed')) {
            alert('Thank you, your records have been updated!');
            document.getElementById('newsletterForm').reset();
        } else {
            alert('Error:\n'+JSON.stringify(result));
        }
    })
    .fail( function(xhr, textStatus, errorThrown) {
        alert('Error '+xhr.status+':\n'+xhr.responseText);
    });
});
</script>
        </div>
        <div class="col-md-3">
          <h2 id="social-media">Social Media</h2>
<p><a href="https://discord.io/eosdac"><i class="icon icon-social-discord-com"></i></a>
<a href="https://github.com/eosdac"><i class="icon icon-social-github-com"></i></a>
<a href="https://steemit.com/@eosdac"><i class="icon icon-social-steemit-com"></i></a>
<a href="https://twitter.com/eosdac"><i class="icon icon-social-twitter-com"></i></a>
<a href="https://www.instagram.com/eosdac"><i class="icon icon-social-instagram-com"></i></a>
<br />
<a href="https://facebook.com/eosdac"><i class="icon icon-social-facebook-com"></i></a>
<a href="https://www.reddit.com/r/eosdac"><i class="icon icon-social-reddit-com"></i></a>
<a href="https://vk.com/eosdac"><i class="icon icon-social-vk-com"></i></a>
<a href="https://www.linkedin.com/company/eosdac/"><i class="icon icon-social-linkedin-com"></i></a>
<a href="https://www.youtube.com/eosdac"><i class="icon icon-social-youtube-com"></i></a>
<br />
<a href="https://murmurdapp.com/userpost/eosdacmurmur"><i class="icon icon-social-murmur"></i></a>
<a href="https://t.me/eosdacio"><i class="icon icon-social-telegram"></i></a></p>

        </div>
      </div>
    </div>

    <div class="container">
      <hr style="padding: 10px 0; border-color: #BABDBE;" /><div class="row">
        <div class="col-md-2">
          <img src="/assets/signet-white.svg" height="50" alt="site.title">
        </div>
        <div class="col-md-10">
          
          
          
          
          <a class="nav-link" href="/why-vote/"
            style="text-transform: none; display: inline-block; margin-top: 5px;
            color: white;">Why Vote for eosDAC?</a>
          
          
          <a class="nav-link" href="/why-join/"
            style="text-transform: none; display: inline-block; margin-top: 5px;
            color: white;">Why Join eosDAC?</a>
          
          
          <a class="nav-link" href="/why-launch/"
            style="text-transform: none; display: inline-block; margin-top: 5px;
            color: white;">Why Launch a DAC?</a>
          
          <a class="nav-link" href="/community/"
            style="text-transform: none; display: inline-block; margin-top: 5px;
            color: white;">Community</a>
          
          
          <a class="nav-link" href="/token/"
            style="text-transform: none; display: inline-block; margin-top: 5px;
            color: white;">Token</a>
          
          <a class="nav-link" href="/tools/"
            style="text-transform: none; display: inline-block; margin-top: 5px;
            color: white;">Tools</a>
          
          
          <a class="nav-link" href="/block-production/"
            style="text-transform: none; display: inline-block; margin-top: 5px;
            color: white;">Block Production</a>
          
          
          
          
          
          
          
          
          
          <a class="nav-link" href="/news/index.html"
            style="text-transform: none; display: inline-block; margin-top: 5px;
            color: white;">News</a>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          </div>
      </div></div>
  </div>
</footer>
<script src="https://vjs.zencdn.net/7.4.1/video.js"></script>
<script src="/assets/videojs-resolution-switcher.js"></script>
<script src="https://unpkg.com/popper.js@1.12.6/dist/umd/popper.js"
  integrity="sha384-fA23ZRQ3G/J53mElWqVJEGJzU0sTs+SvzG8fXVWP+kJQ1lwFAOkcUOysnlKJC33U"
  crossorigin="anonymous"></script>
<script
  src="https://unpkg.com/bootstrap-material-design@4.1.1/dist/js/bootstrap-material-design.js"
  integrity="sha384-CauSuKpEqAFajSpkdjv3z9t8E7RlpJ1UP0lKM/+NdtSarroVKu069AlsRPKkFBz9"
  crossorigin="anonymous"></script>
<script>
$(document).ready(function() {
  $('body').bootstrapMaterialDesign()
  //initialize video players on why-join page
  videojs('why-join-video-1', null, function() {
    var player = this
    window.player = player
    player.on('fullscreenchange', function() {
      if(player.isFullscreen()) {
        label='SD'
        if(screen.width>1280) label='HD'
        player.currentResolution(label)
      } else
        player.currentResolution('SD')
    })
  }).videoJsResolutionSwitcher()
  videojs('why-join-video-2', null, function() {
    var player = this
    window.player = player
    player.on('fullscreenchange', function() {
      if(player.isFullscreen()) {
        label='SD'
        if(screen.width>1280) label='HD'
        player.currentResolution(label)
      } else
        player.currentResolution('SD')
    })
  }).videoJsResolutionSwitcher()
  videojs('why-join-video-3', null, function() {
    var player = this
    window.player = player
    player.on('fullscreenchange', function() {
      if(player.isFullscreen()) {
        label='SD'
        if(screen.width>1280) label='HD'
        player.currentResolution(label)
      } else
        player.currentResolution('SD')
    })
  }).videoJsResolutionSwitcher()
})
</script>
<!-- Voting Modal -->
<div class="modal fade" id="votingModal" tabindex="-1" role="dialog" aria-labelledby="votingModalLabel" aria-hidden="true">
<div class="modal-dialog" role="document">
    <div class="modal-content">
    <form id="votingForm">
    <div class="modal-header">
        <h5 class="modal-title" id="votingModalLabel">You already selected 30 BPs</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
            Free up one spot, to cast a vote for <code class="highlighter-rouge">eosdacserver</code>
        <br/><br/>
        <div class="container-fluid">
            <div class="row">
                <div class="col-6" style="padding:0;padding-right:10px;" id="voting_col1">
                    <!-- Will be filled via Javascript -->
                </div>
                <div class="col-6" style="padding:0;"  id="voting_col2">
                    <!-- Will be filled via Javascript -->
                </div>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <div style="padding: 0 16px;">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
            <button type="submit" class="btn solid dark btn-raised">Vote now</button>
        </div>
    </div>
    </form>
    </div>
</div>
</div>

<script src="/assets/eosjs/eosjs-api.js?1586730102"></script>
<script src="/assets/eosjs/eosjs-jsonrpc.js?1586730102"></script>
<script src="https://cdn.scattercdn.com/file/scatter-cdn/js/latest/scatterjs-core.min.js?1586730102"></script>
<script src="https://cdn.scattercdn.com/file/scatter-cdn/js/latest/scatterjs-plugin-eosjs2.min.js?1586730102"></script>
<script src="https://cdn.scattercdn.com/file/scatter-cdn/js/latest/scatterjs-plugin-lynx.min.js?1586730102"></script>
<script type="text/javascript">
// This file needs to be included via the LIQUID template engine, in order to make the translations work!

// Here is how to calculate the vote decay
// https://github.com/eosdac/eosdactoolkit/blob/master/eosdac-material/src/components/vote-eosdac.vue#L126
// https://github.com/eosdac/eosdactoolkit/blob/master/eosdac-material/src/components/vote-eosdac.vue#L169

const host = 'public.eosinfra.io' //TODO: use eu.eosdac.io instead? -> CORS problem
const network = {
    blockchain:'eos',
    protocol:'https',
    host,
    port:443,
    chainId:'aca376f206b8fc25a6ed44dbdc66547c36c6c33e3a119ffbeaef943642f0e906'
}
const EOSDACSERVER = 'eosdacserver'

function castVote(api, account, producers, proxy = "") {
    const transaction = {
        actions: [{
            account: 'eosio',
            name: 'voteproducer',
            authorization: [{ actor: account.name, permission: account.authority, }],
            data: { producers: producers.sort(), proxy, voter: account.name }
        }]
    }
    return api.transact(transaction, { blocksBehind: 3, expireSeconds: 30 })
}

function errHandler(scatter, target, originalContent, err, showAlert = true) {
    console.error('Voting error:', err)
    target.textContent = originalContent
    scatter.logout()

    // Do not show an alert() if the user rejected the transaction on purpose
    const rejected = ['signature_rejected', 'identity_rejected', 'Request Canceled']
    if(err &&  (rejected.includes(err.type) || rejected.includes(err.message))) {
        showAlert = false
    }
    if(showAlert) alert('Error: ' + JSON.stringify(err))
}

function succHandler(scatter, target, msg = 'Thanks for voting!') {
    target.textContent = msg
    scatter.logout() //all done, goodbye!
}

function oneClickVote(scatter, target, originalContent) {
    target.textContent = 'Voting...'

    const rpc = new eosjs_jsonrpc.JsonRpc('https://'+host)
    const api = new eosjs_api.Api({ rpc, signatureProvider:scatter.eosHook(network, null, true) })

    scatter.login({ accounts: [network] }).then(function() {
        const account = scatter.identity.accounts.find(x => x.blockchain === 'eos')
        /*
        We could also use get_table_rows() to get the voter_info,
        but need to make sure that the result is for 'account.name'.
        get_table_rows({
            json: true,
            code: 'eosio',
            scope: 'eosio',
            table: 'voters',
            lower_bound: account.name,
            limit: 1
        })
        */
        api.rpc.get_account(account.name).then(function(data) {
            const vote = data.voter_info
            let proxy = ''
            let producers = []
            // If vote (e.g. account.voter_info) is 'null', the eosio.voters table is empty for this account,
            // i.e. the account never voted before: Just vote for ['eosdacserver'] in this case!
            if(vote !== null) {
                proxy = vote.proxy
                producers = vote.producers
            }
            if(proxy !== '') {
                api.rpc.get_account(proxy).then(function(data) {
                    if(data && data.voter_info && data.voter_info.is_proxy === 1) {
                        const proxy_producers = data.voter_info.producers
                        const eosdacserverVoted = proxy_producers.some(function(bpName) { return bpName === EOSDACSERVER })
                        if(eosdacserverVoted === true) {
                            // Re-cast vote for the current proxy
                            castVote(api, account, [], proxy).then(function(result) {
                                succHandler(scatter, target, 'Voted proxy: ' + proxy)
                            }).catch(function(err) {
                                errHandler(scatter, target, originalContent, err)
                            })
                        } else {
                            // Re-cast vote for the current proxy, but notify user that it does not support eosdacserver
                            castVote(api, account, [], proxy).then(function(result) {
                                succHandler(scatter, target, 'Voted proxy: ' + proxy)
                                alert(proxy + ' does not support eosDAC. Please consider another proxy!')
                            }).catch(function(err) {
                                errHandler(scatter, target, originalContent, err)
                            })
                        }
                    } else {
                        errHandler(scatter, target, originalContent, proxy+" isn't a proxy anymore")
                        alert(proxy + ' is not a proxy anymore. Please choose another proxy!')
                    }
                }).catch(function(err) {
                    errHandler(scatter, target, originalContent, err)
                })
            } else {
                // Check status of all selected producers, e.g. if they are still registered
                Promise.all(producers.map(p => api.rpc.get_producers(true, p, 1))).then(function(responses) {
                    const reg_producers = responses.map(r => r.rows[0].owner)
                    let new_producers = []
                    // Add all selected AND registered producers into the new_producers array
                    producers.forEach(p => {
                        if(reg_producers.some(rp => rp === p)) new_producers.push(p)
                    })
                    producers = new_producers
                    const eosdacserverVoted = producers.some(function(bpName) { return bpName === EOSDACSERVER })
                    if(eosdacserverVoted === true) {
                        // Re-cast vote for current set of producers (including eosdacserver)
                        castVote(api, account, producers).then(function(result) {
                            succHandler(scatter, target)
                        }).catch(function(err) {
                            errHandler(scatter, target, originalContent, err)
                        })
                    } else {
                        if(producers.length < 30) {
                            // Add 'eosdacserver' to producers list and cast a vote
                            producers.push(EOSDACSERVER)
                            castVote(api, account, producers).then(function(result) {
                                succHandler(scatter, target)
                            }).catch(function(err) {
                                errHandler(scatter, target, originalContent, err)
                            })
                        } else {
                            // Show a modal dialog, to let the user remove one existing producer
                            // Set values inside the modal dialog
                            $('#voting_col1').empty()
                            $('#voting_col2').empty()
                            producers.sort().forEach(function(bpName, idx) {
                                const itm = '<div class="custom-control custom-checkbox"><input type="checkbox" class="custom-control-input" name="bp'+idx+'" id="bp'+idx+'" value="'+bpName+'" checked><label class="custom-control-label" style="font-family:monospace;" for="bp'+idx+'">'+bpName+'</label></div>'
                                if(idx < 15) {
                                    $(itm).appendTo('#voting_col1')
                                } else {
                                    $(itm).appendTo('#voting_col2')
                                }
                            })
                            // Register the submit callback, using local variables
                            $('#votingForm').submit(function(ev) {
                                ev.preventDefault()
                                const producers = $("#votingForm").serializeArray().map(function(elem) {
                                    return elem.value
                                })
                                // Add 'eosdacserver' to producers, if user removed one other producer
                                if(producers.length < 30) {
                                    producers.push(EOSDACSERVER)
                                }
                                castVote(api, account, producers).then(function(result) {
                                    $('#votingModal').modal('hide')
                                    succHandler(scatter, target)
                                }).catch(function(err) {
                                    $('#votingModal').modal('hide')
                                    errHandler(scatter, target, originalContent, err)
                                })
                            })
                            // Register the modal's Cancel/Hide handler, using local variables
                            $('#votingModal').on('hide.bs.modal', function (e) {
                                errHandler(scatter, target, originalContent, 'Modal cancelled/hidden.')
                            })
                            // Show the voting modal
                            $('#votingModal').modal('show')
                        }
                    }
                }).catch(function(err) {
                    errHandler(scatter, target, originalContent, err)
                })
            }
        }).catch(function(err) {
            errHandler(scatter, target, originalContent, err)
        })
    }).catch(function(err) {
        errHandler({ logout: function() { /* Scatter not signed in */ }}, target, originalContent, err)
    })
}

function adoptAuthenticatorByUseragent(idx, obj) {
    const originalContent = obj.textContent
    if(originalContent.includes('Scatter')) {
        const UA = window.navigator.userAgent
        // Detect EOS Lynx according to: https://developers.eoslynx.com/mobile
        if(UA === 'EOSLynx IOS' || UA === 'EOSLynx Android') {
            obj.textContent = originalContent.replace('Scatter', 'EOS Lynx')
            console.info('Adopted for EOSLynx.')
        }
    }
}

$(document).ready(function() {
    ScatterJS.plugins( new ScatterEOS(), new ScatterLynx({ Api: eosjs_api.Api, JsonRpc: eosjs_jsonrpc.JsonRpc }) )
    ScatterJS.scatter.connect('eosDAC.io').then(function( connected ) {
        if(!connected) {
            console.error('Scatter could not be found.')
            return false
        }

        // Scatter was successfully connected
        const scatter = ScatterJS.scatter
        //window.ScatterJS = null
        console.info('Scatter connected.')

        // Setup the click handler for '.scatter-vote-oneclick' links
        // and prevent their default (fallback) link/button behaviour,
        // i.e. do not follow their 'href'
        $('.scatter-vote-oneclick').click(function(ev) {
            ev.preventDefault()
            const target = ev.target
            const originalContent = target.textContent
            oneClickVote(scatter, target, originalContent)
        })
        console.info('Scatter handler registered.')

        // Adopt 'Vote using Scatter' button to 'Vote using EOS Lynx' if applicable
        $('.scatter-vote-oneclick').each(adoptAuthenticatorByUseragent)
    })
})
</script>
</body>

</html>
