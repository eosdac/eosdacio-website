<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>
    
      eosDAC | 
    
  </title>
  <meta property="og:title" content="eosDAC">
  <meta property="og:site_name" content="eosDAC">
  <meta name="description" content="The Community-Owned EOS Block Producer and DAC Enabler">
  <meta property="og:description" content="The Community-Owned EOS Block Producer and DAC Enabler">
  <link rel="shortcut icon" type="image/png" href="/assets/favicon.png?1586730102">
  <link href="/assets/styles.css?1586730102s" rel="stylesheet">
  <link href="https://vjs.zencdn.net/7.4.1/video-js.css" rel="stylesheet">
  <link rel="stylesheet" href="/assets/videojs-resolution-switcher.css">
  <link rel="stylesheet"
    href="https://unpkg.com/bootstrap-material-design@4.1.1/dist/css/bootstrap-material-design.min.css"
    integrity="sha384-wXznGJNEXNG1NFsbm0ugrLFMQPWswR3lds2VeinahP8N0zJw9VWSopbjv2x7WCvX"
    crossorigin="anonymous">
  <link rel="stylesheet" href="/assets/bootstrap-material-design-overwrite.css?1586730102">
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css?family=Roboto:100,200,300,400,500,600">
  <link rel="stylesheet" href="/assets/main.css?1586730102">
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="crossorigin="anonymous"></script><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="site.title" /><link rel="alternate" hreflang="en" href="https://eosdac.io">
  <link rel="alternate" hreflang="ko" href="https://eosdac.io/ko/">
  <link rel="alternate" hreflang="zh-hans" href="https://eosdac.io/zh-hans/">
  <link rel="alternate" hreflang="vi" href="https://eosdac.io/vi/">
  <link rel="alternate" hreflang="ja" href="https://eosdac.io/ja/">
  <link rel="alternate" hreflang="es" href="https://eosdac.io/es/">
  <link rel="alternate" hreflang="ru" href="https://eosdac.io/ru/">
  <link rel="canonical" href="https://eosdac.io/">
  <script src="/assets/vconsole.min.js"></script>
  <script>
    // Init vConsole, if the ?debug=true parameter exists
    if(window.location.search.substr(1).indexOf('debug=true') >= 0) {
      var vConsole = new VConsole()
    }
  </script>
</head>
<body><header class="site-header" role="banner" style="border:0">
  <nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark nav-tabs"
    style="background-image:linear-gradient(to right, #4A1289, #7C41BA)">
    <a class="navbar-brand" href="/">
      <img src="/assets/signet-white.svg" height="42" alt="eosDAC">
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse"
      data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false"
      aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav mr-auto">
        
        
        
        
        
        
        <li class="nav-item"><a class="nav-link" href="/why-vote/">
            Why Vote for eosDAC?</a></li>
        
        
        
        
        
        <li class="nav-item"><a class="nav-link" href="/why-join/">
            Why Join eosDAC?</a></li>
        
        
        
        
        
        <li class="nav-item"><a class="nav-link" href="/why-launch/">
            Why Launch a DAC?</a></li>
        
        
        
        <li class="nav-item"><a class="nav-link" href="/community/">
            Community</a></li>
        
        
        
        
        
        <li class="nav-item"><a class="nav-link" href="/token/">
            Token</a></li>
        
        
        
        <li class="nav-item"><a class="nav-link" href="/tools/">
            Tools</a></li>
        
        
        
        
        
        <li class="nav-item"><a class="nav-link" href="/block-production/">
            Block Production</a></li>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <li class="nav-item"><a class="nav-link" href="/news/index.html">
            News</a></li>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown"
            role="button" data-toggle="dropdown" aria-haspopup="true"
            aria-expanded="false">
            <img src="/assets/flags/en.png" />
          </a>
          <div class="dropdown-menu" aria-labelledby="navbarDropdown">
            
             
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
          </div>
        </li>
      </ul>
      <span class="navbar-text nav-buttons">
        <a href="/why-vote/#voting-matters" class="btn solid light btn-raised scatter-vote-oneclick">
          Vote eosdacserver
        </a>
        <a href="https://members.eosdac.io/" class="btn outline light btn-raised">
          Member Client
        </a>
      </span>
    </div>
  </nav>
</header>
<main class="page-content main" style="padding:0;" aria-label="Content">
      <div class="">
        <div>
<div class="container">
<div class="row" style="margin-top: 20px;">
<div class="col-md-12">
<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">eosDAC 8월 및 9월 작업자 제안과 수입/지출 내역</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2018-10-25T20:19:15+05:30" itemprop="datePublished">Oct 25, 2018
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>8월과 9월달 EOS 지출 내역 보고서입니다. EOS 지출은 다음과 같은 eosDAC의 우선 순위를 반영하여 결정되었습니다: 안정적이고 보안 철저한 블록 생산, eosDAC 커뮤니티 지원 및 토큰 인지도 향상, 전반적인 EOS 생태계와 커뮤니티 지원을 위해 체인 관련 사안에 있어 리더십 발휘.</p>

<hr />

<p>This post is also available in English: <a href="https://steemit.com/eos/@eosdac/eosdac-reports-active-worker-proposals-revenue-and-expenditure-for-august-and-september">eosDAC reports active worker proposals, revenue and expenditure for August and September</a></p>

<hr />

<p>eosDAC의 미션은 체인 상에서 100% 기능하는 DAC이 되는 것으로, 여기서 DAC이란 홀더의 투표로 선출된 운영자가 코드를 업데이트 하여 보다 안전한 코드 환경을 지원하는 조직 구조를 말합니다. DAC의 조직적 구조는 또한 이해 관계를 공유하며 이해 관계에 동기를 가진 작업자 기반을 동원합니다. eosDAC은 DAC 구조의 블록 프로듀서로서, 커뮤니티에서 기술적으로 가장 능숙하고 유능한 팀 중 하나인 블록 생산 팀을 꾸려 EOS 체인의 원활한 작동과 보안에 기여해왔습니다. eosDAC의 블록 생산 팀은 eosDAC의 작업자이면서 동시에 (토큰을 소유한 만큼) eosDAC을 부분적으로 소유한 개인들의 지지를 받고 있습니다. 웹사이트 뉴스란에서 활동 내역을 확인하십시오: https://eosdac.io/news</p>

<p>eosDAC은 블록 프로듀서 순위를 향상하기 위해 적극적인 자세로 많은 작업 계획을 진행 중이며 현재 특히 인지도와 가시성을 높이는 데 중점을 두고 있습니다. (이러한 노력이 10월부터 열매를 맺기 시작하고 있으며 추후 10월 보고서도 업로드될 예정입니다.)</p>

<h3 id="eos-수입-및-지출-2018년-8월-1일--2018년-9월-30일">EOS 수입 및 지출 (2018년 8월 1일 ~ 2018년 9월 30일)</h3>

<hr />
<p><img src="https://cdn.steemitimages.com/DQmdcAtuzy1N3zmForiXtebAhBGrhPmV5VB5JAcgrptJ7QV/image.png" alt="" /></p>

<hr />

<p><strong>블록 생산 (총 22%):</strong> 
블록 생산에 들어가는 비용은 현 eosDAC의 주요 수입원인 블록 생산 수익 유지에 대한 직접 투자입니다. eosDAC의 블록 생산 팀(Rob, Michael, Luke)은 EOS 커뮤니티에서 많은 존경을 받고 있으며. 이들의 희소성있는 기술력과 일주일 내내 24시간 온콜 상태인 헌신도 때문입니다.</p>

<p>eosDAC은 eosDAC은 서비스업체를 통해 다수의 서버에 상당한 비용을 지출하며 이는 서비스업체의 재무보고서에 별도로 보고됩니다.
BP 순위 조회는 <a href="http://eosnetworkmonitor.io/">EOS Network Monitor.io</a>와 같은 다양한 툴로 가능합니다.</p>

<p><strong>DAC 툴 (총 34%)</strong>: 
DAC 툴 대한 투자에는 eosDAC의 관계 및 접근 권한을 결정하는 스마트 계약 및 인터페이스의 백 엔드, 프런트 엔드 및 디자인 구성 요소를 코딩하는 개발자 지불 비용이 포함됩니다. DAC 작업자들은 현재 eosDAC이 온전히 체인 상에서 운영되는 데 필요한 스마트 계약을 쓰고 있습니다. 다음과 같은 스마트 계약이 포함됩니다:</p>

<p>1) 회원 토큰 계약: 회원 클라이언트 및 회원 등록에 필요한 계약입니다. 현재 mebers.eosdac.io/wallet 회원 클라이언트에서 회원 등록이 가능합니다</p>

<p>2) 관리인 계약: 관리인 후보 등록, 관리인 후보 토큰 스테이킹, 관리인 투표, 여러 수준의 접근 허가 및 다중 서명 등 복잡한 기능이 많이 포함됩니다. 곧 온체인 관리인 투표를 시작할 예정입니다. https://members.eosdac.io 클라이언트에서 관리인 후보로 출마할 수 있습니다. <a href="https://www.youtube.com/watch?v=w7lAU8yu4Fo&amp;t=131s">영상 튜토리얼 보기</a></p>

<p>3) 현재 컴파일되고 있는 작업자 제안 계약. 이 계약을 통해 작업자가 작업 제안서를 제출하고, 관리자가 작업자 제안에 투표하고, 승인 받은 작업자가 작업을 완료한 후 보상을 클레임하고, 다중 서명 지불 방식으로 지불받는 것이 체인 상에서 이루어질 수 있습니다.</p>

<p>이 일환으로 마이클 예이츠(Michael Yeates)가 이끄는 개발 팀은 지연된 지불에 대한 시한장치 계약을 생성했습니다.</p>

<p>eosDAC은 계속해서 Object Computing에게 코드 검토를 맡겨 파트너십을 유지하고 있으며, 테스트 스위트를 생산하는 다른 개발자들과도 파트너 관계에 있습니다. Object Computing은 eosDAC 개발자들이 관련 분야에서 가장 높은 수준을 지녔음과 함께 혁신적으로 스마트 코드를 개발하고 있음을 검증했습니다.</p>

<p><strong>커뮤니티 및 소통(총 21%)</strong>: 
커뮤니티 팀은 Telegram 및 Discord 채널 지원하고 있습니다. (<a href="https://t.me/eosdacio">Telegram</a>; <a href="https://t.me/eosdac_korea">한국어 Telegram</a>, <a href="https://discord.gg/B8yDbrN">Discord</a>; 등).</p>

<p>해당 작업자들은 또한 Zendesk와 다른 채널을 통한 질문에 답변하고 있습니다.</p>

<p>또한 커뮤니티 및 소통 팀은 eosDAC의 번역 및 언어별 커뮤니티도 담당합니다. 현재 한국어 및 중국어는 가능한 모두 번역 및 프랑스어, 러시아어, 일본어 및 스페인어는 선택적으로 번역을 지원하고 있습니다. <a href="https://www.youtube.com/channel/UCWEmJ1qNry8yCK0jM74hfGw">YouTube</a> 및 <a href="https://steemit.com/@eosdac">Steemit</a> 채널에서 대부분의 뉴스 콘텐츠가 올라옵니다.</p>

<p><strong>특별 프로젝트(총 15%)</strong>:
eosDAC은 EOS 체인에서 시작하려는 새 Dapp들이 직면하는 체인의 문제에 대해 조사하고, CPU 임대와 같은 생태계 기능을 지원하며, 가치있는 사이드 체인에서 블록을 생산하고, 다른 프로젝트를 직접 지원하여 넓은 의미의 EOS 커뮤니티에서 리더십을 발휘하고 서비스를 제공합니다.</p>

<ul>
  <li>
    <p><strong>DAC 체인 이니셔티브</strong>
DAC을 시작하고 성장시키는 데 필요한 자원과 EOS가 현재 제공하지 않는 부분에 대해 파악한 후 <a href="https://steemit.com/eosdac/@eosdac/the-dac-chain-initiative-announcing-an-exploratory-into-how-usage-of-eos-side-chains-and-separate-chains-may-create-benefits-for">DAC 체인 이니셔티브</a>를 발표하였으며 현 체인 상의 문제를 해결할 수 있는 방안에 대해 연구하고 있습니다. DAC 체인 이니셔티브는 RAM 가격 책정, CPU 공급, 사용자 친화적인 쉬운 계정 생성 등의 문제를 검토할 것이며 결과물로서 메인넷 또는 다른 체인의 개선 방안을 내놓을 것입니다.</p>
  </li>
  <li>
    <p><strong>거래소 접촉</strong>
eosDAC은 지속적으로 거래소들과 연락하여 상장 및 입출금 오픈 지원에 힘쓰고 있습니다.</p>
  </li>
  <li>
    <p><strong>Worbli</strong>
eosDAC은 AML/KYC 인증 기능을 가진 금융 서비스 사이드 체인인 Worbli의 21명 블록 프로듀서 중 하나로 선정되었습니다</p>
  </li>
  <li>
    <p><strong>다른 프로젝트 지원</strong>
EOS 생태계의 새로운 프로젝트가 계속해서 eosDAC의 가이드와 지원을 요청하고 있습니다. eosDAC이 도움을 주는 프로젝트 중 일부는 여기에서 확인할 수 있습니다: https://eosdac.io/enabling-dacs/ 여기에 포함된 프로젝트 및 다른 프로젝트에 도움을 줌으로써 DAC 체인 이니셔티브 연구에 더 많은 정보를 확보할 수 있습니다.</p>
  </li>
</ul>

<p><strong>관리/관리자(총 7%):</strong>
eosDAC의 모든 활동은 온전히 작업자 제안 제도를 통해 운영됩니다. 모든 작업자 제안의 상태는 모두 투명하게 공개되어 웹사이트 https://eosdac.io/active-worker-proposals/ 페이지에서 언제나 확인 가능합니다.</p>

<h3 id="상세-지출-내역-작업자-제안">상세 지출 내역 (작업자 제안)</h3>
<center>![1august.png](https://cdn.steemitimages.com/DQmNxa1MJ2y6vRfGTSBPDaZwRu5e1K9ErxEzdpyQe6EtP6i/1august.png)</center>
<center>![1september.jpg](https://cdn.steemitimages.com/DQmdJ45WN4zr5TgaggwR9i1jR2noKQDWTqSu28J4V8mN8wa/1september.jpg)</center>

<p>-S.M.</p>

<p><a href="https://eosdac.io/"><img src="https://cdn.steemitimages.com/DQmRQWM3QtQ21wddAMCjbVRhB3rM7L4AGWLY9QpNmkXNLps/Screen%20Shot%202018-06-12%20at%2011.00.55%20PM.png" /></a></p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/tqDd8ALhpnw" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen=""></iframe>

<center><h1>BP 후보명: eosdacserver 투표 부탁드립니다
</h1></center>

<p><a href="https://eosdac.io/ko/#newsletter">뉴스레터</a>를 구독하여 정리된 업데이트 목록을 받아보시고 자주 이용하시는 소셜 미디어 플랫폼에서 eosDAC을 팔로우하세요.</p>

<p><sub><a href="https://steemit.com/@eosdac" target="_blank">Steemit</a> | <a href="http://discord.io/eosdac" target="_blank">Discord</a> | <a href="https://t.me/eosdac_korea" target="_blank">Telegram</a> | <a href="https://facebook.com/eosdac" target="_blank">Facebook</a> | <a href="https://twitter.com/eosdac" target="_blank">Twitter</a> | <a href="https://plus.google.com/+eosdac" target="_blank">Google-plus</a> | <a href="https://github.com/eosdac" target="_blank">Github</a> | <a href="https://instagram.com/eosdac" target="_blank">Instagram</a> | <a href="https://linkedin.com/company/eosdac" target="_blank">Linkedin</a> | <a href="https://medium.com/eosdac" target="_blank">Medium</a> | <a href="https://www.reddit.com/r/EOSDAC/" target="_blank">Reddit</a> | <a href="https://www.youtube.com/eosdac" target="_blank">YouTube</a> | &lt;a href=”http://weibo.com/eosdac” target=”_blank”&gt;Weibo&lt;/a&gt;| <a href="https://vk.com/eosdac" target="_blank">VK</a>| <a href="https://bihu.com/people/586348" target="_blank">Bihu</a></sub></p>

  </div><a class="u-url" href="/2018/10/25/eosdac-8-9.html" hidden></a>
</article>

  <a href="https://steemit.com/eos/@koyoungk/eosdac-8-9">Read more ↗</a><br/><br/>


<a href="/news">Back</a>
</div>
</div>
</div><div style="background-image:url(/assets/footer-bkgr.png);background-repeat:no-repeat;background-size:100% auto;margin-top:50px;">
    <img src="/assets/spacer.gif" style="width:100%;"/>
</div></div>
      </div>
    </main><footer class="site-footer h-card" style="border:0;padding:0;">
  <div class="footer">

    <div class="container">
      <div class="row">
        <div class="col-md-3">
          <h2 id="important-links">Important Links</h2>
<p><a href="/why-vote/#core-principles">Code Of Conduct</a><br />
<a href="/history/">eosDAC History</a><br />
<a href="https://eosdac.zendesk.com/">Help Center</a><br />
<a href="/styleguide">Styleguide</a><br />
<a href="https://steemit.com/eos/@eosdac/statement-of-ownership-and-code-of-conduct">Disclosures</a><br />
<a href="/bp.json">BP Info</a></p>

        </div>
        <div class="col-md-6">
          <h2 id="newsletter">Newsletter</h2>

          <form id="newsletterForm">
    <div class="row">
        <div class="col-md-6">
            <div class="form-group">
                <label for="name" class="bmd-label-floating">
                    Name
                </label>
                <input type="text" class="form-control" id="name" name="name">
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
                <label for="email" class="bmd-label-floating">
                    Email *
                </label>
                <input type="email" class="form-control" id="email" name="email"
                    required>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <select class="form-control" id="language" name="language" required>
                <option value="">Language *</option>
                <option value="English">&nbsp;&nbsp;&nbsp;&nbsp;English</option>
                <option value="Russian">&nbsp;&nbsp;&nbsp;&nbsp;Pусский</option>
                <option value="Korean">&nbsp;&nbsp;&nbsp;&nbsp;한국어</option>
                <option value="Chinese">&nbsp;&nbsp;&nbsp;&nbsp;简体中文</option>
            </select>
        </div>
        <div class="col-md-6">
            <button type="submit" id="submitButton" class="btn">
                Subscribe
            </button>
        </div>
    </div>
</form>
<script>
$('#newsletterForm').submit(function(event) {
    event.preventDefault();
    $.post('https://toolkit-api.eosdac.io/subscribe', $(this).serialize())
    .done( function(result) {
        if(result && (result.message === 'subscribed_successfully' || result.message === 'already_subscribed')) {
            alert('Thank you, your records have been updated!');
            document.getElementById('newsletterForm').reset();
        } else {
            alert('Error:\n'+JSON.stringify(result));
        }
    })
    .fail( function(xhr, textStatus, errorThrown) {
        alert('Error '+xhr.status+':\n'+xhr.responseText);
    });
});
</script>
        </div>
        <div class="col-md-3">
          <h2 id="social-media">Social Media</h2>
<p><a href="https://discord.io/eosdac"><i class="icon icon-social-discord-com"></i></a>
<a href="https://github.com/eosdac"><i class="icon icon-social-github-com"></i></a>
<a href="https://steemit.com/@eosdac"><i class="icon icon-social-steemit-com"></i></a>
<a href="https://twitter.com/eosdac"><i class="icon icon-social-twitter-com"></i></a>
<a href="https://www.instagram.com/eosdac"><i class="icon icon-social-instagram-com"></i></a>
<br />
<a href="https://facebook.com/eosdac"><i class="icon icon-social-facebook-com"></i></a>
<a href="https://www.reddit.com/r/eosdac"><i class="icon icon-social-reddit-com"></i></a>
<a href="https://vk.com/eosdac"><i class="icon icon-social-vk-com"></i></a>
<a href="https://www.linkedin.com/company/eosdac/"><i class="icon icon-social-linkedin-com"></i></a>
<a href="https://www.youtube.com/eosdac"><i class="icon icon-social-youtube-com"></i></a>
<br />
<a href="https://murmurdapp.com/userpost/eosdacmurmur"><i class="icon icon-social-murmur"></i></a>
<a href="https://t.me/eosdacio"><i class="icon icon-social-telegram"></i></a></p>

        </div>
      </div>
    </div>

    <div class="container">
      <hr style="padding: 10px 0; border-color: #BABDBE;" /><div class="row">
        <div class="col-md-2">
          <img src="/assets/signet-white.svg" height="50" alt="site.title">
        </div>
        <div class="col-md-10">
          
          
          
          
          <a class="nav-link" href="/why-vote/"
            style="text-transform: none; display: inline-block; margin-top: 5px;
            color: white;">Why Vote for eosDAC?</a>
          
          
          <a class="nav-link" href="/why-join/"
            style="text-transform: none; display: inline-block; margin-top: 5px;
            color: white;">Why Join eosDAC?</a>
          
          
          <a class="nav-link" href="/why-launch/"
            style="text-transform: none; display: inline-block; margin-top: 5px;
            color: white;">Why Launch a DAC?</a>
          
          <a class="nav-link" href="/community/"
            style="text-transform: none; display: inline-block; margin-top: 5px;
            color: white;">Community</a>
          
          
          <a class="nav-link" href="/token/"
            style="text-transform: none; display: inline-block; margin-top: 5px;
            color: white;">Token</a>
          
          <a class="nav-link" href="/tools/"
            style="text-transform: none; display: inline-block; margin-top: 5px;
            color: white;">Tools</a>
          
          
          <a class="nav-link" href="/block-production/"
            style="text-transform: none; display: inline-block; margin-top: 5px;
            color: white;">Block Production</a>
          
          
          
          
          
          
          
          
          
          <a class="nav-link" href="/news/index.html"
            style="text-transform: none; display: inline-block; margin-top: 5px;
            color: white;">News</a>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          </div>
      </div></div>
  </div>
</footer>
<script src="https://vjs.zencdn.net/7.4.1/video.js"></script>
<script src="/assets/videojs-resolution-switcher.js"></script>
<script src="https://unpkg.com/popper.js@1.12.6/dist/umd/popper.js"
  integrity="sha384-fA23ZRQ3G/J53mElWqVJEGJzU0sTs+SvzG8fXVWP+kJQ1lwFAOkcUOysnlKJC33U"
  crossorigin="anonymous"></script>
<script
  src="https://unpkg.com/bootstrap-material-design@4.1.1/dist/js/bootstrap-material-design.js"
  integrity="sha384-CauSuKpEqAFajSpkdjv3z9t8E7RlpJ1UP0lKM/+NdtSarroVKu069AlsRPKkFBz9"
  crossorigin="anonymous"></script>
<script>
$(document).ready(function() {
  $('body').bootstrapMaterialDesign()
  //initialize video players on why-join page
  videojs('why-join-video-1', null, function() {
    var player = this
    window.player = player
    player.on('fullscreenchange', function() {
      if(player.isFullscreen()) {
        label='SD'
        if(screen.width>1280) label='HD'
        player.currentResolution(label)
      } else
        player.currentResolution('SD')
    })
  }).videoJsResolutionSwitcher()
  videojs('why-join-video-2', null, function() {
    var player = this
    window.player = player
    player.on('fullscreenchange', function() {
      if(player.isFullscreen()) {
        label='SD'
        if(screen.width>1280) label='HD'
        player.currentResolution(label)
      } else
        player.currentResolution('SD')
    })
  }).videoJsResolutionSwitcher()
  videojs('why-join-video-3', null, function() {
    var player = this
    window.player = player
    player.on('fullscreenchange', function() {
      if(player.isFullscreen()) {
        label='SD'
        if(screen.width>1280) label='HD'
        player.currentResolution(label)
      } else
        player.currentResolution('SD')
    })
  }).videoJsResolutionSwitcher()
})
</script>
<!-- Voting Modal -->
<div class="modal fade" id="votingModal" tabindex="-1" role="dialog" aria-labelledby="votingModalLabel" aria-hidden="true">
<div class="modal-dialog" role="document">
    <div class="modal-content">
    <form id="votingForm">
    <div class="modal-header">
        <h5 class="modal-title" id="votingModalLabel">You already selected 30 BPs</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
            Free up one spot, to cast a vote for <code class="highlighter-rouge">eosdacserver</code>
        <br/><br/>
        <div class="container-fluid">
            <div class="row">
                <div class="col-6" style="padding:0;padding-right:10px;" id="voting_col1">
                    <!-- Will be filled via Javascript -->
                </div>
                <div class="col-6" style="padding:0;"  id="voting_col2">
                    <!-- Will be filled via Javascript -->
                </div>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <div style="padding: 0 16px;">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
            <button type="submit" class="btn solid dark btn-raised">Vote now</button>
        </div>
    </div>
    </form>
    </div>
</div>
</div>

<script src="/assets/eosjs/eosjs-api.js?1586730102"></script>
<script src="/assets/eosjs/eosjs-jsonrpc.js?1586730102"></script>
<script src="https://cdn.scattercdn.com/file/scatter-cdn/js/latest/scatterjs-core.min.js?1586730102"></script>
<script src="https://cdn.scattercdn.com/file/scatter-cdn/js/latest/scatterjs-plugin-eosjs2.min.js?1586730102"></script>
<script src="https://cdn.scattercdn.com/file/scatter-cdn/js/latest/scatterjs-plugin-lynx.min.js?1586730102"></script>
<script type="text/javascript">
// This file needs to be included via the LIQUID template engine, in order to make the translations work!

// Here is how to calculate the vote decay
// https://github.com/eosdac/eosdactoolkit/blob/master/eosdac-material/src/components/vote-eosdac.vue#L126
// https://github.com/eosdac/eosdactoolkit/blob/master/eosdac-material/src/components/vote-eosdac.vue#L169

const host = 'public.eosinfra.io' //TODO: use eu.eosdac.io instead? -> CORS problem
const network = {
    blockchain:'eos',
    protocol:'https',
    host,
    port:443,
    chainId:'aca376f206b8fc25a6ed44dbdc66547c36c6c33e3a119ffbeaef943642f0e906'
}
const EOSDACSERVER = 'eosdacserver'

function castVote(api, account, producers, proxy = "") {
    const transaction = {
        actions: [{
            account: 'eosio',
            name: 'voteproducer',
            authorization: [{ actor: account.name, permission: account.authority, }],
            data: { producers: producers.sort(), proxy, voter: account.name }
        }]
    }
    return api.transact(transaction, { blocksBehind: 3, expireSeconds: 30 })
}

function errHandler(scatter, target, originalContent, err, showAlert = true) {
    console.error('Voting error:', err)
    target.textContent = originalContent
    scatter.logout()

    // Do not show an alert() if the user rejected the transaction on purpose
    const rejected = ['signature_rejected', 'identity_rejected', 'Request Canceled']
    if(err &&  (rejected.includes(err.type) || rejected.includes(err.message))) {
        showAlert = false
    }
    if(showAlert) alert('Error: ' + JSON.stringify(err))
}

function succHandler(scatter, target, msg = 'Thanks for voting!') {
    target.textContent = msg
    scatter.logout() //all done, goodbye!
}

function oneClickVote(scatter, target, originalContent) {
    target.textContent = 'Voting...'

    const rpc = new eosjs_jsonrpc.JsonRpc('https://'+host)
    const api = new eosjs_api.Api({ rpc, signatureProvider:scatter.eosHook(network, null, true) })

    scatter.login({ accounts: [network] }).then(function() {
        const account = scatter.identity.accounts.find(x => x.blockchain === 'eos')
        /*
        We could also use get_table_rows() to get the voter_info,
        but need to make sure that the result is for 'account.name'.
        get_table_rows({
            json: true,
            code: 'eosio',
            scope: 'eosio',
            table: 'voters',
            lower_bound: account.name,
            limit: 1
        })
        */
        api.rpc.get_account(account.name).then(function(data) {
            const vote = data.voter_info
            let proxy = ''
            let producers = []
            // If vote (e.g. account.voter_info) is 'null', the eosio.voters table is empty for this account,
            // i.e. the account never voted before: Just vote for ['eosdacserver'] in this case!
            if(vote !== null) {
                proxy = vote.proxy
                producers = vote.producers
            }
            if(proxy !== '') {
                api.rpc.get_account(proxy).then(function(data) {
                    if(data && data.voter_info && data.voter_info.is_proxy === 1) {
                        const proxy_producers = data.voter_info.producers
                        const eosdacserverVoted = proxy_producers.some(function(bpName) { return bpName === EOSDACSERVER })
                        if(eosdacserverVoted === true) {
                            // Re-cast vote for the current proxy
                            castVote(api, account, [], proxy).then(function(result) {
                                succHandler(scatter, target, 'Voted proxy: ' + proxy)
                            }).catch(function(err) {
                                errHandler(scatter, target, originalContent, err)
                            })
                        } else {
                            // Re-cast vote for the current proxy, but notify user that it does not support eosdacserver
                            castVote(api, account, [], proxy).then(function(result) {
                                succHandler(scatter, target, 'Voted proxy: ' + proxy)
                                alert(proxy + ' does not support eosDAC. Please consider another proxy!')
                            }).catch(function(err) {
                                errHandler(scatter, target, originalContent, err)
                            })
                        }
                    } else {
                        errHandler(scatter, target, originalContent, proxy+" isn't a proxy anymore")
                        alert(proxy + ' is not a proxy anymore. Please choose another proxy!')
                    }
                }).catch(function(err) {
                    errHandler(scatter, target, originalContent, err)
                })
            } else {
                // Check status of all selected producers, e.g. if they are still registered
                Promise.all(producers.map(p => api.rpc.get_producers(true, p, 1))).then(function(responses) {
                    const reg_producers = responses.map(r => r.rows[0].owner)
                    let new_producers = []
                    // Add all selected AND registered producers into the new_producers array
                    producers.forEach(p => {
                        if(reg_producers.some(rp => rp === p)) new_producers.push(p)
                    })
                    producers = new_producers
                    const eosdacserverVoted = producers.some(function(bpName) { return bpName === EOSDACSERVER })
                    if(eosdacserverVoted === true) {
                        // Re-cast vote for current set of producers (including eosdacserver)
                        castVote(api, account, producers).then(function(result) {
                            succHandler(scatter, target)
                        }).catch(function(err) {
                            errHandler(scatter, target, originalContent, err)
                        })
                    } else {
                        if(producers.length < 30) {
                            // Add 'eosdacserver' to producers list and cast a vote
                            producers.push(EOSDACSERVER)
                            castVote(api, account, producers).then(function(result) {
                                succHandler(scatter, target)
                            }).catch(function(err) {
                                errHandler(scatter, target, originalContent, err)
                            })
                        } else {
                            // Show a modal dialog, to let the user remove one existing producer
                            // Set values inside the modal dialog
                            $('#voting_col1').empty()
                            $('#voting_col2').empty()
                            producers.sort().forEach(function(bpName, idx) {
                                const itm = '<div class="custom-control custom-checkbox"><input type="checkbox" class="custom-control-input" name="bp'+idx+'" id="bp'+idx+'" value="'+bpName+'" checked><label class="custom-control-label" style="font-family:monospace;" for="bp'+idx+'">'+bpName+'</label></div>'
                                if(idx < 15) {
                                    $(itm).appendTo('#voting_col1')
                                } else {
                                    $(itm).appendTo('#voting_col2')
                                }
                            })
                            // Register the submit callback, using local variables
                            $('#votingForm').submit(function(ev) {
                                ev.preventDefault()
                                const producers = $("#votingForm").serializeArray().map(function(elem) {
                                    return elem.value
                                })
                                // Add 'eosdacserver' to producers, if user removed one other producer
                                if(producers.length < 30) {
                                    producers.push(EOSDACSERVER)
                                }
                                castVote(api, account, producers).then(function(result) {
                                    $('#votingModal').modal('hide')
                                    succHandler(scatter, target)
                                }).catch(function(err) {
                                    $('#votingModal').modal('hide')
                                    errHandler(scatter, target, originalContent, err)
                                })
                            })
                            // Register the modal's Cancel/Hide handler, using local variables
                            $('#votingModal').on('hide.bs.modal', function (e) {
                                errHandler(scatter, target, originalContent, 'Modal cancelled/hidden.')
                            })
                            // Show the voting modal
                            $('#votingModal').modal('show')
                        }
                    }
                }).catch(function(err) {
                    errHandler(scatter, target, originalContent, err)
                })
            }
        }).catch(function(err) {
            errHandler(scatter, target, originalContent, err)
        })
    }).catch(function(err) {
        errHandler({ logout: function() { /* Scatter not signed in */ }}, target, originalContent, err)
    })
}

function adoptAuthenticatorByUseragent(idx, obj) {
    const originalContent = obj.textContent
    if(originalContent.includes('Scatter')) {
        const UA = window.navigator.userAgent
        // Detect EOS Lynx according to: https://developers.eoslynx.com/mobile
        if(UA === 'EOSLynx IOS' || UA === 'EOSLynx Android') {
            obj.textContent = originalContent.replace('Scatter', 'EOS Lynx')
            console.info('Adopted for EOSLynx.')
        }
    }
}

$(document).ready(function() {
    ScatterJS.plugins( new ScatterEOS(), new ScatterLynx({ Api: eosjs_api.Api, JsonRpc: eosjs_jsonrpc.JsonRpc }) )
    ScatterJS.scatter.connect('eosDAC.io').then(function( connected ) {
        if(!connected) {
            console.error('Scatter could not be found.')
            return false
        }

        // Scatter was successfully connected
        const scatter = ScatterJS.scatter
        //window.ScatterJS = null
        console.info('Scatter connected.')

        // Setup the click handler for '.scatter-vote-oneclick' links
        // and prevent their default (fallback) link/button behaviour,
        // i.e. do not follow their 'href'
        $('.scatter-vote-oneclick').click(function(ev) {
            ev.preventDefault()
            const target = ev.target
            const originalContent = target.textContent
            oneClickVote(scatter, target, originalContent)
        })
        console.info('Scatter handler registered.')

        // Adopt 'Vote using Scatter' button to 'Vote using EOS Lynx' if applicable
        $('.scatter-vote-oneclick').each(adoptAuthenticatorByUseragent)
    })
})
</script>
</body>

</html>
