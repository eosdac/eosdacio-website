<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>
    
      eosDAC | The Community-Owned EOS Block Producer and DAC Enabler
    
  </title>
  <meta property="og:title" content="eosDAC">
  <meta property="og:site_name" content="eosDAC">
  <meta name="description" content="The Community-Owned EOS Block Producer and DAC Enabler">
  <meta property="og:description" content="The Community-Owned EOS Block Producer and DAC Enabler">
  <link rel="shortcut icon" type="image/png" href="/assets/favicon.png?1586616978">
  <link href="/assets/styles.css?1586616978s" rel="stylesheet">
  <link href="https://vjs.zencdn.net/7.4.1/video-js.css" rel="stylesheet">
  <link rel="stylesheet" href="/assets/videojs-resolution-switcher.css">
  <link rel="stylesheet"
    href="https://unpkg.com/bootstrap-material-design@4.1.1/dist/css/bootstrap-material-design.min.css"
    integrity="sha384-wXznGJNEXNG1NFsbm0ugrLFMQPWswR3lds2VeinahP8N0zJw9VWSopbjv2x7WCvX"
    crossorigin="anonymous">
  <link rel="stylesheet" href="/assets/bootstrap-material-design-overwrite.css?1586616978">
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css?family=Roboto:100,200,300,400,500,600">
  <link rel="stylesheet" href="/assets/main.css?1586616978">
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="crossorigin="anonymous"></script><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="site.title" /><link rel="alternate" hreflang="en" href="https://eosdac.io">
  <link rel="alternate" hreflang="ko" href="https://eosdac.io/ko/">
  <link rel="alternate" hreflang="zh-hans" href="https://eosdac.io/zh-hans/">
  <link rel="alternate" hreflang="vi" href="https://eosdac.io/vi/">
  <link rel="alternate" hreflang="ja" href="https://eosdac.io/ja/">
  <link rel="alternate" hreflang="es" href="https://eosdac.io/es/">
  <link rel="alternate" hreflang="ru" href="https://eosdac.io/ru/">
  <link rel="canonical" href="https://eosdac.io/">
  <script src="/assets/vconsole.min.js"></script>
  <script>
    // Init vConsole, if the ?debug=true parameter exists
    if(window.location.search.substr(1).indexOf('debug=true') >= 0) {
      var vConsole = new VConsole()
    }
  </script>
</head>
<body><header class="site-header" role="banner" style="border:0">
  <nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark nav-tabs"
    style="background-image:linear-gradient(to right, #4A1289, #7C41BA)">
    <a class="navbar-brand" href="/">
      <img src="/assets/signet-white.svg" height="42" alt="eosDAC">
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse"
      data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false"
      aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav mr-auto">
        
        
        
        
        
        
        <li class="nav-item"><a class="nav-link" href="/why-vote/">
            Why Vote for eosDAC?</a></li>
        
        
        
        
        
        <li class="nav-item"><a class="nav-link" href="/why-join/">
            Why Join eosDAC?</a></li>
        
        
        
        
        
        <li class="nav-item"><a class="nav-link" href="/why-launch/">
            Why Launch a DAC?</a></li>
        
        
        
        <li class="nav-item"><a class="nav-link" href="/community/">
            Community</a></li>
        
        
        
        
        
        <li class="nav-item"><a class="nav-link" href="/token/">
            Token</a></li>
        
        
        
        <li class="nav-item"><a class="nav-link" href="/tools/">
            Tools</a></li>
        
        
        
        
        
        <li class="nav-item"><a class="nav-link" href="/block-production/">
            Block Production</a></li>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <li class="nav-item"><a class="nav-link" href="/news/index.html">
            News</a></li>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown"
            role="button" data-toggle="dropdown" aria-haspopup="true"
            aria-expanded="false">
            <img src="/assets/flags/en.png" />
          </a>
          <div class="dropdown-menu" aria-labelledby="navbarDropdown">
            
             
            
            
            
            <a class="dropdown-item" href="/ko/history/">
              <img src="/assets/flags/ko.png" />&nbsp;한국어
            </a>
            
            
            
            
            
            
            <a class="dropdown-item" href="/zh-hans/history/">
              <img src="/assets/flags/zh-hans.png" />&nbsp;简体中文
            </a>
            
            
            
            
            
            
            <a class="dropdown-item" href="/vi/history/">
              <img src="/assets/flags/vi.png" />&nbsp;Tiếng Việt
            </a>
            
            
            
            
            
            
            <a class="dropdown-item" href="/ja/history/">
              <img src="/assets/flags/ja.png" />&nbsp;日本語
            </a>
            
            
            
            
            
            
            <a class="dropdown-item" href="/es/history/">
              <img src="/assets/flags/es.png" />&nbsp;Español
            </a>
            
            
            
            
            
            
            <a class="dropdown-item" href="/ru/history/">
              <img src="/assets/flags/ru.png" />&nbsp;Pусский
            </a>
            
            
            
          </div>
        </li>
      </ul>
      <span class="navbar-text nav-buttons">
        <a href="/why-vote/#voting-matters" class="btn solid light btn-raised scatter-vote-oneclick">
          Vote eosdacserver
        </a>
        <a href="https://members.eosdac.io/" class="btn outline light btn-raised">
          Member Client
        </a>
      </span>
    </div>
  </nav>
</header>
<main class="page-content main" style="padding:0;" aria-label="Content">
      <div class="">
        <div class="history">
<div class="section head dark">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <h1 id="eosdac-history">eos<strong>DAC History</strong></h1>

<p>In the month of March 2018 eosDAC introduced itself as a community-owned EOS Block producer and highlighted its vision that <em>EOS.IO block production should be open for everyone to contribute and benefit.</em></p>

      </div>
    </div>
  </div>
</div>

<div class="section">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <h1 id="eosdac-inception">eos<strong>DAC Inception</strong></h1>

<p>In order to create an EOS Block producer that is owned by the EOS community itself, eosDAC dropped 75% of eosDAC tokens to the EOS Token Holders, 20% were given to the launch team members, Advisors and to build a wider community. The remaining 5% of eosDAC tokens were given to eosDAC Ltd, which are intended to be used as a capital reserve.</p>

<p>You can read more about this intro here: <a href="https://steemit.com/eos/@eosdac/introducing-eosdac-the-community-owned-eos-block-producer">https://steemit.com/eos/@eosdac/introducing-eosdac-the-community-owned-eos-block-producer</a></p>

<p>Later in the same month eosDAC announced its block producer candidacy introducing itself as a Block Producer candidate on EOSio along with details about its server infrastructure and a brief introduction to the launch team.</p>

<p>eosDAC Block producer candidacy announcement can be found here: <a href="https://steemit.com/eos/@eosdac/eosdac-block-producer-candidate-information">https://steemit.com/eos/@eosdac/eosdac-block-producer-candidate-information</a></p>

<h1 id="beyond-block-production---the-dac-enabler">Beyond block production - The DAC Enabler</h1>

<p>eosDAC was born out of Dan Larimer’s concept of Decentralized Autonomous Communities or DACs, around which Block.one developed EOS software led by Dan Larimer and Brendan Blumer.</p>

<p>Block.One’s early presentations talked about EOS.IO software ushering in ‘The Era of DACs’.(watch here). They showed how DACs were more transparent, auditable, trustworthy and inclusive than existing companies and how this would result in DACs being ultra competitive.</p>

<p>eosDAC shares the same vision for how DACs can disrupt how business can be done. We believe that these new business models can challenge how we think about what a company will be. Blockchain technologies introduce new business opportunities which create value and give it back to the community, rather than only extracting resources from their environment. All connected parties to the DAC are incentivized to continually add value, therefore stimulating creativity and growth.</p>

<p>In order to function, DACs need tools that aren’t currently available. eosDAC has created these tools and, through its commitment to open source software, will share them as a “DAC Factory” that anyone can take and use to set up and run a DAC.</p>

<p>The DAC Factory will evolve organically and over time and will include the core concepts of membership, voting, custodians, and proposals. Any account holding EOSDAC tokens can become a Member and get rights to benefit from the DAC, stand as a custodian, vote for custodians and submit proposals. Custodians are the DAC decision makers and will be continually voted for and held accountable by members. Proposals will be voted for by custodians and once approved (subject to available funds being available) will be implemented, checked and paid for. All proposals will provide some deliverables and benefits to the DAC ecosystem.</p>

<p>The DAC Factory will need to make sure that all of the different cogs of the DAC machine run smoothly.</p>

<p><img src="/assets/history/dac-enabler.png" alt="DAC Enabler" /></p>

<p>Over time, other DAC structures and tools could be supported. It is also envisaged that other individuals, groups, and DACs will join and build upon the tools we create. Beyond software, the DAC Factory will also include best practices alongside legal and regulatory guidance for different jurisdictions. This will include a case study on eosDAC’s endeavors.</p>

<p>eosDAC will continue to work on suitable ‘off-the-shelf’ structures for DACs to interact with the worldwide legal and financial systems, in fact, everything that a new DAC will need in order to be established and flourish.</p>

<h1 id="airdrop-completion-and-token-burn-on-the-ethereum-network">Airdrop completion and token burn on the Ethereum network.</h1>

<p>eosDAC finished airdropping eosDAC tokens on May 15 2018, the final figures of the airdrop were.</p>

<p><img src="/assets/history/token-burn.png" alt="Token Burn" /></p>

<p><strong>238,080,898.455</strong> tokens were burned. This amount will be sent to the unrecoverable Ethereum account 0x0000000000000000000000000000000000e05dac later today.</p>

<p>Leaving a circulating supply of  <strong>961 919 101.545</strong> eosDAC Tokens.</p>

<p>Full information on airdrop completion and burn can be found here: <a href="https://steemit.com/eos/@eosdac/eosdac-airdrop-and-burn">https://steemit.com/eos/@eosdac/eosdac-airdrop-and-burn</a></p>

<p>It was later identified that some supporting exchanges and 1 individual account were withheld and their tokens were burnt. After much discussion, it was decided to include these tokens during the eosDAC token swap to EOS network. 
A full statement of inclusion of wallets in the eosDAC token transition to EOS Chain can be found here :
<a href="https://steemit.com/eos/@eosdac/statement-on-inclusion-of-specific-exchange-wallets-in-the-eosdac-token-transition-to-the-eos-chain">https://steemit.com/eos/@eosdac/statement-on-inclusion-of-specific-exchange-wallets-in-the-eosdac-token-transition-to-the-eos-chain</a></p>

<h1 id="eosdac-contributions-in-launching-and-securing-the-mainnet">eosDAC contributions in launching and securing the mainnet.</h1>

<p>eosDAC was a part of the Ghostbusters team along with EOS Rio, HKEOS, Sw/eden, EOS Tribe, EOS 42 to name a few.</p>

<h2 id="what-is-ghostbusters">What is Ghostbusters?</h2>

<p>Ghostbusters started as an EOS testnet focused on researching and rehearsing the best practices for running the eosio software as securely as possible. It all started because we were worried about the lack of focus regarding infrastructure security.
It was initiated as a research environment, not a launch initiative, it quickly attracted the attention of the community and other BPCs who were feeling the same way we do concerning security. Then people started recommending it as a launch approach.</p>

<p>Micheal Yeates from eosDAC found a DDOS bug that qualified for 10k EOS developer bounty. The bug allowed an attacker to consume 100% of the node’s CPU.
<a href="https://twitter.com/eosdac/status/1005154586188009473">https://twitter.com/eosdac/status/1005154586188009473</a></p>

<p>eosDAC tech team spent a countless number of hours on never-ending zoom calls with other BPCs and weeks of sleepless nights to ensure a secured launch of EOS mainnet and months before testing the EOSIO software on the Community Testnets.</p>

<h1 id="token-swap">Token Swap</h1>

<p>After launching the mainnet launch success, eosDAC completed the token swap in the 3rd week of June.</p>

<p>Following was the outcome.</p>
<ol>
  <li>Total supply - <strong>994,895,254.98</strong>
    <ul>
      <li>Token airdropped - <strong>987896341.6</strong></li>
      <li>Locked in DEX contracts -  <strong>4,473,804.66</strong></li>
      <li>Failed Fallback - <strong>2,525,108.71</strong></li>
    </ul>
  </li>
  <li>Total tokens burned <strong>205097655.6</strong></li>
</ol>

<p>eosDAC will try to recover the tokens that are stuck in DEX contracts like Forkdelta and Idex and the ones for which fallbacks couldn’t be generated
Full report: <a href="https://docs.google.com/document/d/1irdLXCz4yJqdLPAeG2EgLGvyQAlXZ-DivU0i-PTTKBY/edit">https://docs.google.com/document/d/1irdLXCz4yJqdLPAeG2EgLGvyQAlXZ-DivU0i-PTTKBY/edit</a></p>

<h1 id="prioritizing-dac-factory-and-partnering-with-object-computing">Prioritizing DAC Factory and Partnering with Object Computing</h1>

<p>After completing the token distribution major focus was the DAC Factory, eosDAC partnered with OCI (https://objectcomputing.com/) who helped Block One build EOS and are one of the best in the business. OCI is helping eosDAC to code review our smart contracts and is working very closely with our tech team to accelerate the progress of on the DAC Factory.</p>

<p>Read more here: <a href="https://steemit.com/eos/@eosdac/eosdac-accelerates-progress-on-dac-toolkit-partners-with-object-computing">https://steemit.com/eos/@eosdac/eosdac-accelerates-progress-on-dac-toolkit-partners-with-object-computing</a>
Just a few days ago eosDAC announced its first approved Worker Proposals, prioritizing block production and DAC Factory. Read more here: <a href="https://steemit.com/eosdac/@eosdac/eosdac-announces-first-approved-worker-proposals-prioritising-block-production-and-dac-toolkit">https://steemit.com/eosdac/@eosdac/eosdac-announces-first-approved-worker-proposals-prioritising-block-production-and-dac-toolkit</a></p>

<p>Currently, the team is set to launch its MVP version of its DAC Toolkit soon, with Membership and Custodian Voting contracts. 
You can follow the DAC Toolkit roadmap here: <a href="https://trello.com/b/fbz4IHXP/dac-toolkit-roadmap">https://trello.com/b/fbz4IHXP/dac-toolkit-roadmap</a></p>

      </div>
    </div>
  </div><div style="background-image:url(/assets/footer-bkgr.png);background-repeat:no-repeat;background-size:100% auto;margin-top:50px;">
    <img src="/assets/spacer.gif" style="width:100%;"/>
</div></div>
</div>

      </div>
    </main><footer class="site-footer h-card" style="border:0;padding:0;">
  <div class="footer">

    <div class="container">
      <div class="row">
        <div class="col-md-3">
          <h2 id="important-links">Important Links</h2>
<p><a href="/why-vote/#core-principles">Code Of Conduct</a><br />
<a href="/history/">eosDAC History</a><br />
<a href="https://eosdac.zendesk.com/">Help Center</a><br />
<a href="/styleguide">Styleguide</a><br />
<a href="https://steemit.com/eos/@eosdac/statement-of-ownership-and-code-of-conduct">Disclosures</a><br />
<a href="/bp.json">BP Info</a></p>

        </div>
        <div class="col-md-6">
          <h2 id="newsletter">Newsletter</h2>

          <form id="newsletterForm">
    <div class="row">
        <div class="col-md-6">
            <div class="form-group">
                <label for="name" class="bmd-label-floating">
                    Name
                </label>
                <input type="text" class="form-control" id="name" name="name">
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
                <label for="email" class="bmd-label-floating">
                    Email *
                </label>
                <input type="email" class="form-control" id="email" name="email"
                    required>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <select class="form-control" id="language" name="language" required>
                <option value="">Language *</option>
                <option value="English">&nbsp;&nbsp;&nbsp;&nbsp;English</option>
                <option value="Russian">&nbsp;&nbsp;&nbsp;&nbsp;Pусский</option>
                <option value="Korean">&nbsp;&nbsp;&nbsp;&nbsp;한국어</option>
                <option value="Chinese">&nbsp;&nbsp;&nbsp;&nbsp;简体中文</option>
            </select>
        </div>
        <div class="col-md-6">
            <button type="submit" id="submitButton" class="btn">
                Subscribe
            </button>
        </div>
    </div>
</form>
<script>
$('#newsletterForm').submit(function(event) {
    event.preventDefault();
    $.post('https://toolkit-api.eosdac.io/subscribe', $(this).serialize())
    .done( function(result) {
        if(result && (result.message === 'subscribed_successfully' || result.message === 'already_subscribed')) {
            alert('Thank you, your records have been updated!');
            document.getElementById('newsletterForm').reset();
        } else {
            alert('Error:\n'+JSON.stringify(result));
        }
    })
    .fail( function(xhr, textStatus, errorThrown) {
        alert('Error '+xhr.status+':\n'+xhr.responseText);
    });
});
</script>
        </div>
        <div class="col-md-3">
          <h2 id="social-media">Social Media</h2>
<p><a href="https://discord.io/eosdac"><i class="icon icon-social-discord-com"></i></a>
<a href="https://github.com/eosdac"><i class="icon icon-social-github-com"></i></a>
<a href="https://steemit.com/@eosdac"><i class="icon icon-social-steemit-com"></i></a>
<a href="https://twitter.com/eosdac"><i class="icon icon-social-twitter-com"></i></a>
<a href="https://www.instagram.com/eosdac"><i class="icon icon-social-instagram-com"></i></a>
<br />
<a href="https://facebook.com/eosdac"><i class="icon icon-social-facebook-com"></i></a>
<a href="https://www.reddit.com/r/eosdac"><i class="icon icon-social-reddit-com"></i></a>
<a href="https://vk.com/eosdac"><i class="icon icon-social-vk-com"></i></a>
<a href="https://www.linkedin.com/company/eosdac/"><i class="icon icon-social-linkedin-com"></i></a>
<a href="https://www.youtube.com/eosdac"><i class="icon icon-social-youtube-com"></i></a>
<br />
<a href="https://murmurdapp.com/userpost/eosdacmurmur"><i class="icon icon-social-murmur"></i></a>
<a href="https://t.me/eosdacio"><i class="icon icon-social-telegram"></i></a></p>

        </div>
      </div>
    </div>

    <div class="container">
      <hr style="padding: 10px 0; border-color: #BABDBE;" /><div class="row">
        <div class="col-md-2">
          <img src="/assets/signet-white.svg" height="50" alt="site.title">
        </div>
        <div class="col-md-10">
          
          
          
          
          <a class="nav-link" href="/why-vote/"
            style="text-transform: none; display: inline-block; margin-top: 5px;
            color: white;">Why Vote for eosDAC?</a>
          
          
          <a class="nav-link" href="/why-join/"
            style="text-transform: none; display: inline-block; margin-top: 5px;
            color: white;">Why Join eosDAC?</a>
          
          
          <a class="nav-link" href="/why-launch/"
            style="text-transform: none; display: inline-block; margin-top: 5px;
            color: white;">Why Launch a DAC?</a>
          
          <a class="nav-link" href="/community/"
            style="text-transform: none; display: inline-block; margin-top: 5px;
            color: white;">Community</a>
          
          
          <a class="nav-link" href="/token/"
            style="text-transform: none; display: inline-block; margin-top: 5px;
            color: white;">Token</a>
          
          <a class="nav-link" href="/tools/"
            style="text-transform: none; display: inline-block; margin-top: 5px;
            color: white;">Tools</a>
          
          
          <a class="nav-link" href="/block-production/"
            style="text-transform: none; display: inline-block; margin-top: 5px;
            color: white;">Block Production</a>
          
          
          
          
          
          
          
          
          
          <a class="nav-link" href="/news/index.html"
            style="text-transform: none; display: inline-block; margin-top: 5px;
            color: white;">News</a>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          </div>
      </div></div>
  </div>
</footer>
<script src="https://vjs.zencdn.net/7.4.1/video.js"></script>
<script src="/assets/videojs-resolution-switcher.js"></script>
<script src="https://unpkg.com/popper.js@1.12.6/dist/umd/popper.js"
  integrity="sha384-fA23ZRQ3G/J53mElWqVJEGJzU0sTs+SvzG8fXVWP+kJQ1lwFAOkcUOysnlKJC33U"
  crossorigin="anonymous"></script>
<script
  src="https://unpkg.com/bootstrap-material-design@4.1.1/dist/js/bootstrap-material-design.js"
  integrity="sha384-CauSuKpEqAFajSpkdjv3z9t8E7RlpJ1UP0lKM/+NdtSarroVKu069AlsRPKkFBz9"
  crossorigin="anonymous"></script>
<script>
$(document).ready(function() {
  $('body').bootstrapMaterialDesign()
  //initialize video players on why-join page
  videojs('why-join-video-1', null, function() {
    var player = this
    window.player = player
    player.on('fullscreenchange', function() {
      if(player.isFullscreen()) {
        label='SD'
        if(screen.width>1280) label='HD'
        player.currentResolution(label)
      } else
        player.currentResolution('SD')
    })
  }).videoJsResolutionSwitcher()
  videojs('why-join-video-2', null, function() {
    var player = this
    window.player = player
    player.on('fullscreenchange', function() {
      if(player.isFullscreen()) {
        label='SD'
        if(screen.width>1280) label='HD'
        player.currentResolution(label)
      } else
        player.currentResolution('SD')
    })
  }).videoJsResolutionSwitcher()
  videojs('why-join-video-3', null, function() {
    var player = this
    window.player = player
    player.on('fullscreenchange', function() {
      if(player.isFullscreen()) {
        label='SD'
        if(screen.width>1280) label='HD'
        player.currentResolution(label)
      } else
        player.currentResolution('SD')
    })
  }).videoJsResolutionSwitcher()
})
</script>
<!-- Voting Modal -->
<div class="modal fade" id="votingModal" tabindex="-1" role="dialog" aria-labelledby="votingModalLabel" aria-hidden="true">
<div class="modal-dialog" role="document">
    <div class="modal-content">
    <form id="votingForm">
    <div class="modal-header">
        <h5 class="modal-title" id="votingModalLabel">You already selected 30 BPs</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
            Free up one spot, to cast a vote for <code class="highlighter-rouge">eosdacserver</code>
        <br/><br/>
        <div class="container-fluid">
            <div class="row">
                <div class="col-6" style="padding:0;padding-right:10px;" id="voting_col1">
                    <!-- Will be filled via Javascript -->
                </div>
                <div class="col-6" style="padding:0;"  id="voting_col2">
                    <!-- Will be filled via Javascript -->
                </div>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <div style="padding: 0 16px;">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
            <button type="submit" class="btn solid dark btn-raised">Vote now</button>
        </div>
    </div>
    </form>
    </div>
</div>
</div>

<script src="/assets/eosjs/eosjs-api.js?1586616978"></script>
<script src="/assets/eosjs/eosjs-jsonrpc.js?1586616978"></script>
<script src="https://cdn.scattercdn.com/file/scatter-cdn/js/latest/scatterjs-core.min.js?1586616978"></script>
<script src="https://cdn.scattercdn.com/file/scatter-cdn/js/latest/scatterjs-plugin-eosjs2.min.js?1586616978"></script>
<script src="https://cdn.scattercdn.com/file/scatter-cdn/js/latest/scatterjs-plugin-lynx.min.js?1586616978"></script>
<script type="text/javascript">
// This file needs to be included via the LIQUID template engine, in order to make the translations work!

// Here is how to calculate the vote decay
// https://github.com/eosdac/eosdactoolkit/blob/master/eosdac-material/src/components/vote-eosdac.vue#L126
// https://github.com/eosdac/eosdactoolkit/blob/master/eosdac-material/src/components/vote-eosdac.vue#L169

const host = 'public.eosinfra.io' //TODO: use eu.eosdac.io instead? -> CORS problem
const network = {
    blockchain:'eos',
    protocol:'https',
    host,
    port:443,
    chainId:'aca376f206b8fc25a6ed44dbdc66547c36c6c33e3a119ffbeaef943642f0e906'
}
const EOSDACSERVER = 'eosdacserver'

function castVote(api, account, producers, proxy = "") {
    const transaction = {
        actions: [{
            account: 'eosio',
            name: 'voteproducer',
            authorization: [{ actor: account.name, permission: account.authority, }],
            data: { producers: producers.sort(), proxy, voter: account.name }
        }]
    }
    return api.transact(transaction, { blocksBehind: 3, expireSeconds: 30 })
}

function errHandler(scatter, target, originalContent, err, showAlert = true) {
    console.error('Voting error:', err)
    target.textContent = originalContent
    scatter.logout()

    // Do not show an alert() if the user rejected the transaction on purpose
    const rejected = ['signature_rejected', 'identity_rejected', 'Request Canceled']
    if(err &&  (rejected.includes(err.type) || rejected.includes(err.message))) {
        showAlert = false
    }
    if(showAlert) alert('Error: ' + JSON.stringify(err))
}

function succHandler(scatter, target, msg = 'Thanks for voting!') {
    target.textContent = msg
    scatter.logout() //all done, goodbye!
}

function oneClickVote(scatter, target, originalContent) {
    target.textContent = 'Voting...'

    const rpc = new eosjs_jsonrpc.JsonRpc('https://'+host)
    const api = new eosjs_api.Api({ rpc, signatureProvider:scatter.eosHook(network, null, true) })

    scatter.login({ accounts: [network] }).then(function() {
        const account = scatter.identity.accounts.find(x => x.blockchain === 'eos')
        /*
        We could also use get_table_rows() to get the voter_info,
        but need to make sure that the result is for 'account.name'.
        get_table_rows({
            json: true,
            code: 'eosio',
            scope: 'eosio',
            table: 'voters',
            lower_bound: account.name,
            limit: 1
        })
        */
        api.rpc.get_account(account.name).then(function(data) {
            const vote = data.voter_info
            let proxy = ''
            let producers = []
            // If vote (e.g. account.voter_info) is 'null', the eosio.voters table is empty for this account,
            // i.e. the account never voted before: Just vote for ['eosdacserver'] in this case!
            if(vote !== null) {
                proxy = vote.proxy
                producers = vote.producers
            }
            if(proxy !== '') {
                api.rpc.get_account(proxy).then(function(data) {
                    if(data && data.voter_info && data.voter_info.is_proxy === 1) {
                        const proxy_producers = data.voter_info.producers
                        const eosdacserverVoted = proxy_producers.some(function(bpName) { return bpName === EOSDACSERVER })
                        if(eosdacserverVoted === true) {
                            // Re-cast vote for the current proxy
                            castVote(api, account, [], proxy).then(function(result) {
                                succHandler(scatter, target, 'Voted proxy: ' + proxy)
                            }).catch(function(err) {
                                errHandler(scatter, target, originalContent, err)
                            })
                        } else {
                            // Re-cast vote for the current proxy, but notify user that it does not support eosdacserver
                            castVote(api, account, [], proxy).then(function(result) {
                                succHandler(scatter, target, 'Voted proxy: ' + proxy)
                                alert(proxy + ' does not support eosDAC. Please consider another proxy!')
                            }).catch(function(err) {
                                errHandler(scatter, target, originalContent, err)
                            })
                        }
                    } else {
                        errHandler(scatter, target, originalContent, proxy+" isn't a proxy anymore")
                        alert(proxy + ' is not a proxy anymore. Please choose another proxy!')
                    }
                }).catch(function(err) {
                    errHandler(scatter, target, originalContent, err)
                })
            } else {
                // Check status of all selected producers, e.g. if they are still registered
                Promise.all(producers.map(p => api.rpc.get_producers(true, p, 1))).then(function(responses) {
                    const reg_producers = responses.map(r => r.rows[0].owner)
                    let new_producers = []
                    // Add all selected AND registered producers into the new_producers array
                    producers.forEach(p => {
                        if(reg_producers.some(rp => rp === p)) new_producers.push(p)
                    })
                    producers = new_producers
                    const eosdacserverVoted = producers.some(function(bpName) { return bpName === EOSDACSERVER })
                    if(eosdacserverVoted === true) {
                        // Re-cast vote for current set of producers (including eosdacserver)
                        castVote(api, account, producers).then(function(result) {
                            succHandler(scatter, target)
                        }).catch(function(err) {
                            errHandler(scatter, target, originalContent, err)
                        })
                    } else {
                        if(producers.length < 30) {
                            // Add 'eosdacserver' to producers list and cast a vote
                            producers.push(EOSDACSERVER)
                            castVote(api, account, producers).then(function(result) {
                                succHandler(scatter, target)
                            }).catch(function(err) {
                                errHandler(scatter, target, originalContent, err)
                            })
                        } else {
                            // Show a modal dialog, to let the user remove one existing producer
                            // Set values inside the modal dialog
                            $('#voting_col1').empty()
                            $('#voting_col2').empty()
                            producers.sort().forEach(function(bpName, idx) {
                                const itm = '<div class="custom-control custom-checkbox"><input type="checkbox" class="custom-control-input" name="bp'+idx+'" id="bp'+idx+'" value="'+bpName+'" checked><label class="custom-control-label" style="font-family:monospace;" for="bp'+idx+'">'+bpName+'</label></div>'
                                if(idx < 15) {
                                    $(itm).appendTo('#voting_col1')
                                } else {
                                    $(itm).appendTo('#voting_col2')
                                }
                            })
                            // Register the submit callback, using local variables
                            $('#votingForm').submit(function(ev) {
                                ev.preventDefault()
                                const producers = $("#votingForm").serializeArray().map(function(elem) {
                                    return elem.value
                                })
                                // Add 'eosdacserver' to producers, if user removed one other producer
                                if(producers.length < 30) {
                                    producers.push(EOSDACSERVER)
                                }
                                castVote(api, account, producers).then(function(result) {
                                    $('#votingModal').modal('hide')
                                    succHandler(scatter, target)
                                }).catch(function(err) {
                                    $('#votingModal').modal('hide')
                                    errHandler(scatter, target, originalContent, err)
                                })
                            })
                            // Register the modal's Cancel/Hide handler, using local variables
                            $('#votingModal').on('hide.bs.modal', function (e) {
                                errHandler(scatter, target, originalContent, 'Modal cancelled/hidden.')
                            })
                            // Show the voting modal
                            $('#votingModal').modal('show')
                        }
                    }
                }).catch(function(err) {
                    errHandler(scatter, target, originalContent, err)
                })
            }
        }).catch(function(err) {
            errHandler(scatter, target, originalContent, err)
        })
    }).catch(function(err) {
        errHandler({ logout: function() { /* Scatter not signed in */ }}, target, originalContent, err)
    })
}

function adoptAuthenticatorByUseragent(idx, obj) {
    const originalContent = obj.textContent
    if(originalContent.includes('Scatter')) {
        const UA = window.navigator.userAgent
        // Detect EOS Lynx according to: https://developers.eoslynx.com/mobile
        if(UA === 'EOSLynx IOS' || UA === 'EOSLynx Android') {
            obj.textContent = originalContent.replace('Scatter', 'EOS Lynx')
            console.info('Adopted for EOSLynx.')
        }
    }
}

$(document).ready(function() {
    ScatterJS.plugins( new ScatterEOS(), new ScatterLynx({ Api: eosjs_api.Api, JsonRpc: eosjs_jsonrpc.JsonRpc }) )
    ScatterJS.scatter.connect('eosDAC.io').then(function( connected ) {
        if(!connected) {
            console.error('Scatter could not be found.')
            return false
        }

        // Scatter was successfully connected
        const scatter = ScatterJS.scatter
        //window.ScatterJS = null
        console.info('Scatter connected.')

        // Setup the click handler for '.scatter-vote-oneclick' links
        // and prevent their default (fallback) link/button behaviour,
        // i.e. do not follow their 'href'
        $('.scatter-vote-oneclick').click(function(ev) {
            ev.preventDefault()
            const target = ev.target
            const originalContent = target.textContent
            oneClickVote(scatter, target, originalContent)
        })
        console.info('Scatter handler registered.')

        // Adopt 'Vote using Scatter' button to 'Vote using EOS Lynx' if applicable
        $('.scatter-vote-oneclick').each(adoptAuthenticatorByUseragent)
    })
})
</script>
</body>

</html>
